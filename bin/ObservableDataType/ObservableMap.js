"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const ObservableVariable_1 = require("./ObservableVariable");
/**
 * 可观察改变Map
 */
class ObservableMap extends ObservableVariable_1.ObservableVariable {
    constructor(value) {
        super(value);
        //#endregion
        //#region 属性
        this._onAdd = new Set();
        this._onRemove = new Set();
        this._onUpdate = new Set();
        if (this !== value)
            if (Array.isArray(value))
                this._value = new Map(value);
    }
    static observe(value, path) {
        if (path === undefined) {
            return new ObservableMap(value);
        }
        else if ('string' === typeof path) {
            path = path.split('.');
        }
        for (let index = 0, end = path.length - 1; index < end; index++) {
            value = value[path[index]];
        }
        value[path[path.length - 1]] = new ObservableMap(value[path[path.length - 1]]);
    }
    /**
     * Map元素个数
     */
    get size() {
        return this._value.size;
    }
    //#endregion
    //#region toJSON
    toJSON() {
        return this.serializable ? [...this._value] : undefined;
    }
    on(event, callback) {
        switch (event) {
            case 'update':
                this._onUpdate.add(callback);
                break;
            case 'add':
                this._onAdd.add(callback);
                break;
            case 'remove':
                this._onRemove.add(callback);
                break;
            default:
                super.on(event, callback);
                break;
        }
    }
    once(event, callback) {
        super.once(event, callback);
    }
    off(event, callback) {
        switch (event) {
            case 'update':
                callback ? this._onUpdate.delete(callback) : this._onUpdate.clear();
                break;
            case 'add':
                callback ? this._onAdd.delete(callback) : this._onAdd.clear();
                break;
            case 'remove':
                callback ? this._onRemove.delete(callback) : this._onRemove.clear();
                break;
            default:
                super.off(event, callback);
                break;
        }
    }
    //#endregion
    //#region Map修改操作方法
    /**
     * 移除Map对象中的所有元素。
     */
    clear() {
        if (this.readonly)
            throw new Error(`尝试修改一个只读的 ${this.constructor.name}`);
        if (this._onRemove.size > 0) {
            this._value.forEach((value, key) => {
                this._value.delete(key);
                this._onRemove.forEach(callback => callback(value, key));
            });
        }
        else
            this._value.clear();
    }
    /**
     * 用于移除 Map 对象中指定的元素。
     */
    delete(key) {
        if (this.readonly)
            throw new Error(`尝试修改一个只读的 ${this.constructor.name}`);
        if (this._onRemove.size > 0) {
            if (this._value.has(key)) {
                const value = this._value.get(key);
                this._value.delete(key);
                this._onRemove.forEach(callback => callback(value, key));
                return true;
            }
            else
                return false;
        }
        else
            return this._value.delete(key);
    }
    /**
     * 为Map对象添加一个指定键（key）和值（value）的新元素。
     */
    set(key, value) {
        if (this.readonly)
            throw new Error(`尝试修改一个只读的 ${this.constructor.name}`);
        if (this._value.has(key)) {
            const oldValue = this._value.get(key);
            this._value.set(key, value);
            this._onUpdate.forEach(callback => callback(value, oldValue, key));
        }
        else {
            this._value.set(key, value);
            this._onAdd.forEach(callback => callback(value, key));
        }
        return this;
    }
    //#endregion
    //#region Map读取操作方法
    /**
     * 返回一个新的包含 [key, value] 对的 Iterator 对象，返回的迭代器的迭代顺序与 Map 对象的插入顺序相同。
     */
    entries() {
        return this._value.entries();
    }
    /**
     * 以插入顺序对 Map 对象中的每一个键值对执行一次参数中提供的回调函数。
     */
    forEach(callbackfn, thisArg) {
        this._value.forEach(callbackfn, thisArg);
    }
    /**
     * 用来获取一个 Map 对象中指定的元素。
     */
    get(key) {
        return this._value.get(key);
    }
    /**
     * 返回一个bool值，用来表明map 中是否存在指定元素
     */
    has(key) {
        return this._value.has(key);
    }
    /**
     * 返回一个新的 Iterator 对象。它包含按照顺序插入Map对象中每个元素的key值。
     */
    keys() {
        return this._value.keys();
    }
    /**
     * 返回一个新的Iterator对象。它包含按顺序插入Map对象中每个元素的value值。
     */
    values() {
        return this._value.values();
    }
}
exports.ObservableMap = ObservableMap;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk9ic2VydmFibGVEYXRhVHlwZS9PYnNlcnZhYmxlTWFwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsNkRBQTBEO0FBRTFEOztHQUVHO0FBQ0gsbUJBQWlDLFNBQVEsdUNBQTZCO0lBc0NsRSxZQUFZLEtBQThEO1FBQ3RFLEtBQUssQ0FBQyxLQUFZLENBQUMsQ0FBQztRQVR4QixZQUFZO1FBRVosWUFBWTtRQUVGLFdBQU0sR0FBb0MsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUNwRCxjQUFTLEdBQW9DLElBQUksR0FBRyxFQUFFLENBQUM7UUFDdkQsY0FBUyxHQUFvRCxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBSzdFLElBQUksSUFBSSxLQUFLLEtBQUs7WUFDZCxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDO2dCQUNwQixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3pDLENBQUM7SUE1QkQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFVLEVBQUUsSUFBVTtRQUNqQyxJQUFJLElBQUksS0FBSyxTQUFTLEVBQUU7WUFDcEIsT0FBTyxJQUFJLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUNuQzthQUFNLElBQUksUUFBUSxLQUFLLE9BQU8sSUFBSSxFQUFFO1lBQ2pDLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1NBQzFCO1FBRUQsS0FBSyxJQUFJLEtBQUssR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLEtBQUssR0FBRyxHQUFHLEVBQUUsS0FBSyxFQUFFLEVBQUU7WUFDN0QsS0FBSyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztTQUM5QjtRQUVELEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksYUFBYSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDbkYsQ0FBQztJQWtCRDs7T0FFRztJQUNILElBQUksSUFBSTtRQUNKLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDNUIsQ0FBQztJQUVELFlBQVk7SUFFWixnQkFBZ0I7SUFFTixNQUFNO1FBQ1osT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7SUFDNUQsQ0FBQztJQTRCRCxFQUFFLENBQUMsS0FBVSxFQUFFLFFBQWE7UUFDeEIsUUFBUSxLQUFLLEVBQUU7WUFDWCxLQUFLLFFBQVE7Z0JBQ1QsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQzdCLE1BQU07WUFFVixLQUFLLEtBQUs7Z0JBQ04sSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQzFCLE1BQU07WUFFVixLQUFLLFFBQVE7Z0JBQ1QsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQzdCLE1BQU07WUFFVjtnQkFDSSxLQUFLLENBQUMsRUFBRSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQztnQkFDMUIsTUFBTTtTQUNiO0lBQ0wsQ0FBQztJQU9ELElBQUksQ0FBQyxLQUFVLEVBQUUsUUFBYTtRQUMxQixLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQztJQUNoQyxDQUFDO0lBT0QsR0FBRyxDQUFDLEtBQVUsRUFBRSxRQUFhO1FBQ3pCLFFBQVEsS0FBSyxFQUFFO1lBQ1gsS0FBSyxRQUFRO2dCQUNULFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBQ3BFLE1BQU07WUFFVixLQUFLLEtBQUs7Z0JBQ04sUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztnQkFDOUQsTUFBTTtZQUVWLEtBQUssUUFBUTtnQkFDVCxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxDQUFDO2dCQUNwRSxNQUFNO1lBRVY7Z0JBQ0ksS0FBSyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLENBQUM7Z0JBQzNCLE1BQU07U0FDYjtJQUNMLENBQUM7SUFFRCxZQUFZO0lBRVosbUJBQW1CO0lBRW5COztPQUVHO0lBQ0gsS0FBSztRQUNELElBQUksSUFBSSxDQUFDLFFBQVE7WUFDYixNQUFNLElBQUksS0FBSyxDQUFDLGFBQWEsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBRTFELElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxFQUFFO1lBQ3pCLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRSxFQUFFO2dCQUMvQixJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDeEIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDN0QsQ0FBQyxDQUFDLENBQUM7U0FDTjs7WUFDRyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQzVCLENBQUM7SUFFRDs7T0FFRztJQUNILE1BQU0sQ0FBQyxHQUFNO1FBQ1QsSUFBSSxJQUFJLENBQUMsUUFBUTtZQUNiLE1BQU0sSUFBSSxLQUFLLENBQUMsYUFBYSxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7UUFFMUQsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksR0FBRyxDQUFDLEVBQUU7WUFDekIsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRTtnQkFDdEIsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ25DLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUN4QixJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxLQUFVLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDOUQsT0FBTyxJQUFJLENBQUM7YUFDZjs7Z0JBQ0csT0FBTyxLQUFLLENBQUM7U0FDcEI7O1lBQ0csT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUN2QyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxHQUFHLENBQUMsR0FBTSxFQUFFLEtBQVE7UUFDaEIsSUFBSSxJQUFJLENBQUMsUUFBUTtZQUNiLE1BQU0sSUFBSSxLQUFLLENBQUMsYUFBYSxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7UUFFMUQsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUN0QixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQU0sQ0FBQztZQUUzQyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDNUIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO1NBQ3RFO2FBQU07WUFDSCxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDNUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7U0FDekQ7UUFFRCxPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDO0lBRUQsWUFBWTtJQUVaLG1CQUFtQjtJQUVuQjs7T0FFRztJQUNILE9BQU87UUFDSCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDakMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsT0FBTyxDQUFDLFVBQXNELEVBQUUsT0FBYTtRQUN6RSxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDN0MsQ0FBQztJQUVEOztPQUVHO0lBQ0gsR0FBRyxDQUFDLEdBQU07UUFDTixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBTSxDQUFDO0lBQ3JDLENBQUM7SUFFRDs7T0FFRztJQUNILEdBQUcsQ0FBQyxHQUFNO1FBQ04sT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNoQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxJQUFJO1FBQ0EsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQzlCLENBQUM7SUFFRDs7T0FFRztJQUNILE1BQU07UUFDRixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUM7SUFDaEMsQ0FBQztDQUdKO0FBdlBELHNDQXVQQyIsImZpbGUiOiJPYnNlcnZhYmxlRGF0YVR5cGUvT2JzZXJ2YWJsZU1hcC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGVWYXJpYWJsZSB9IGZyb20gXCIuL09ic2VydmFibGVWYXJpYWJsZVwiO1xyXG5cclxuLyoqXHJcbiAqIOWPr+inguWvn+aUueWPmE1hcFxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIE9ic2VydmFibGVNYXA8SywgVj4gZXh0ZW5kcyBPYnNlcnZhYmxlVmFyaWFibGU8TWFwPEssIFY+PiB7XHJcblxyXG4gICAgLy8jcmVnaW9uIOmdmeaAgeaWueazlVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5bCG5LiA5Liq5pWw57uE6L2s5o2i5oiQ5Y+v6KeC5a+fTWFw77yM55u45b2T5LqOIG5ldyBPYnNlcnZhYmxlTWFwKHZhbHVlKVxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgb2JzZXJ2ZTxLLCBWPih2YWx1ZTogT2JzZXJ2YWJsZU1hcDxLLCBWPiB8IE1hcDxLLCBWPiB8IFJlYWRvbmx5QXJyYXk8W0ssIFZdPik6IE9ic2VydmFibGVNYXA8SywgVj47XHJcbiAgICAvKipcclxuICAgICAqIOWwhuWvueixoeS4reaMh+WumuS9jee9rueahOS4gOS4quaVsOe7hOi9rOaNouaIkOWPr+inguWvn01hcO+8jOi3r+W+hOmAmui/h2AuYOWIhuWJslxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgb2JzZXJ2ZShvYmplY3Q6IG9iamVjdCwgcGF0aDogc3RyaW5nKTogdm9pZDtcclxuICAgIC8qKlxyXG4gICAgICog5bCG5a+56LGh5Lit5oyH5a6a5L2N572u55qE5LiA5Liq5pWw57uE6L2s5o2i5oiQ5Y+v6KeC5a+fTWFwXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBvYnNlcnZlKG9iamVjdDogb2JqZWN0LCBwYXRoOiBzdHJpbmdbXSk6IHZvaWQ7XHJcbiAgICBzdGF0aWMgb2JzZXJ2ZSh2YWx1ZTogYW55LCBwYXRoPzogYW55KTogYW55IHtcclxuICAgICAgICBpZiAocGF0aCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZU1hcCh2YWx1ZSk7XHJcbiAgICAgICAgfSBlbHNlIGlmICgnc3RyaW5nJyA9PT0gdHlwZW9mIHBhdGgpIHtcclxuICAgICAgICAgICAgcGF0aCA9IHBhdGguc3BsaXQoJy4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvciAobGV0IGluZGV4ID0gMCwgZW5kID0gcGF0aC5sZW5ndGggLSAxOyBpbmRleCA8IGVuZDsgaW5kZXgrKykge1xyXG4gICAgICAgICAgICB2YWx1ZSA9IHZhbHVlW3BhdGhbaW5kZXhdXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhbHVlW3BhdGhbcGF0aC5sZW5ndGggLSAxXV0gPSBuZXcgT2JzZXJ2YWJsZU1hcCh2YWx1ZVtwYXRoW3BhdGgubGVuZ3RoIC0gMV1dKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyNlbmRyZWdpb25cclxuXHJcbiAgICAvLyNyZWdpb24g5bGe5oCnXHJcblxyXG4gICAgcHJvdGVjdGVkIF9vbkFkZDogU2V0PCh2YWx1ZTogViwga2V5OiBLKSA9PiB2b2lkPiA9IG5ldyBTZXQoKTtcclxuICAgIHByb3RlY3RlZCBfb25SZW1vdmU6IFNldDwodmFsdWU6IFYsIGtleTogSykgPT4gdm9pZD4gPSBuZXcgU2V0KCk7XHJcbiAgICBwcm90ZWN0ZWQgX29uVXBkYXRlOiBTZXQ8KG5ld1ZhbHVlOiBWLCBvbGRWYWx1ZTogViwga2V5OiBLKSA9PiB2b2lkPiA9IG5ldyBTZXQoKTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcih2YWx1ZTogT2JzZXJ2YWJsZU1hcDxLLCBWPiB8IE1hcDxLLCBWPiB8IFJlYWRvbmx5QXJyYXk8W0ssIFZdPikge1xyXG4gICAgICAgIHN1cGVyKHZhbHVlIGFzIGFueSk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzICE9PSB2YWx1ZSlcclxuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5fdmFsdWUgPSBuZXcgTWFwKHZhbHVlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIE1hcOWFg+e0oOS4quaVsFxyXG4gICAgICovXHJcbiAgICBnZXQgc2l6ZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUuc2l6ZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyNlbmRyZWdpb25cclxuXHJcbiAgICAvLyNyZWdpb24gdG9KU09OXHJcblxyXG4gICAgcHJvdGVjdGVkIHRvSlNPTigpOiBhbnkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNlcmlhbGl6YWJsZSA/IFsuLi50aGlzLl92YWx1ZV0gOiB1bmRlZmluZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgLy8jZW5kcmVnaW9uXHJcblxyXG4gICAgLy8jcmVnaW9uIOS6i+S7tue7keWumuaWueazlVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5b2T6K6+572u5YC855qE5pe25YCZ6Kem5Y+RXHJcbiAgICAgKi9cclxuICAgIG9uKGV2ZW50OiAnc2V0JywgY2FsbGJhY2s6IChuZXdWYWx1ZTogTWFwPEssIFY+LCBvbGRWYWx1ZTogTWFwPEssIFY+KSA9PiB2b2lkKTogdm9pZDtcclxuICAgIC8qKlxyXG4gICAgICog5Zyo5YC85Y+R55Sf5pS55Y+Y5LmL5YmN6Kem5Y+R77yM6L+U5ZueZmFsc2XooajnpLrpmLvmraLmm7TmlLnvvIzlpoLmnpzopoHmm7TmlLluZXdWYWx1ZeWPr+S7peiwg+eUqGNoYW5nZVRv44CCXHJcbiAgICAgKiDms6jmhI/vvJror6Xlm57osIPlj6rlhYHorrjorr7nva7kuIDkuKrvvIzph43lpI3orr7nva7lsIbopobnm5bkuYvliY3nmoTlm57osIPvvIzlkIzml7borr7nva7nmoTlm57osIPmmK/ku6XlkIzmraXmlrnlvI/miafooYznmoTjgIJcclxuICAgICAqIOazqOaEj++8muWmguaenOimgeaJp+ihjGNoYW5nZVRv77yM5YiZ5bCx5LiN5bqU5YaN6L+U5ZueZmFsc2XkuobvvIzlkKbliJnlsIbkvb/lvpdjaGFuZ2VUb+aXoOaViOOAglxyXG4gICAgICovXHJcbiAgICBvbihldmVudDogJ2JlZm9yZVNldCcsIGNhbGxiYWNrOiAobmV3VmFsdWU6IE1hcDxLLCBWPiwgb2xkVmFsdWU6IE1hcDxLLCBWPiwgY2hhbmdlVG86ICh2YWx1ZTogTWFwPEssIFY+KSA9PiB2b2lkLCBvVmFyOiB0aGlzKSA9PiBib29sZWFuIHwgdm9pZCk6IHZvaWQ7XHJcbiAgICAvKipcclxuICAgICAqIOW9k+abtOaWsE1hcOS4reafkOS4quWFg+e0oOeahOWAvOaXtuinpuWPkVxyXG4gICAgICovXHJcbiAgICBvbihldmVudDogJ3VwZGF0ZScsIGNhbGxiYWNrOiAobmV3VmFsdWU6IFYsIG9sZFZhbHVlOiBWLCBrZXk6IEspID0+IHZvaWQpOiB2b2lkO1xyXG4gICAgLyoqXHJcbiAgICAgKiDlvZPlkJFNYXDkuK3mt7vliqDlhYPntKDml7bop6blj5FcclxuICAgICAqL1xyXG4gICAgb24oZXZlbnQ6ICdhZGQnLCBjYWxsYmFjazogKHZhbHVlOiBWLCBrZXk6IEspID0+IHZvaWQpOiB2b2lkO1xyXG4gICAgLyoqXHJcbiAgICAgKiDlvZPliKDpmaRNYXDkuK3lhYPntKDml7bop6blj5FcclxuICAgICAqL1xyXG4gICAgb24oZXZlbnQ6ICdyZW1vdmUnLCBjYWxsYmFjazogKHZhbHVlOiBWLCBrZXk6IEspID0+IHZvaWQpOiB2b2lkO1xyXG4gICAgb24oZXZlbnQ6IGFueSwgY2FsbGJhY2s6IGFueSk6IGFueSB7XHJcbiAgICAgICAgc3dpdGNoIChldmVudCkge1xyXG4gICAgICAgICAgICBjYXNlICd1cGRhdGUnOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fb25VcGRhdGUuYWRkKGNhbGxiYWNrKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSAnYWRkJzpcclxuICAgICAgICAgICAgICAgIHRoaXMuX29uQWRkLmFkZChjYWxsYmFjayk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgJ3JlbW92ZSc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9vblJlbW92ZS5hZGQoY2FsbGJhY2spO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgc3VwZXIub24oZXZlbnQsIGNhbGxiYWNrKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvbmNlKGV2ZW50OiAnc2V0JywgY2FsbGJhY2s6IChuZXdWYWx1ZTogTWFwPEssIFY+LCBvbGRWYWx1ZTogTWFwPEssIFY+KSA9PiB2b2lkKTogdm9pZDtcclxuICAgIG9uY2UoZXZlbnQ6ICdiZWZvcmVTZXQnLCBjYWxsYmFjazogKG5ld1ZhbHVlOiBNYXA8SywgVj4sIG9sZFZhbHVlOiBNYXA8SywgVj4sIGNoYW5nZVRvOiAodmFsdWU6IE1hcDxLLCBWPikgPT4gdm9pZCwgb1ZhcjogdGhpcykgPT4gYm9vbGVhbiB8IHZvaWQpOiB2b2lkO1xyXG4gICAgb25jZShldmVudDogJ3VwZGF0ZScsIGNhbGxiYWNrOiAobmV3VmFsdWU6IFYsIG9sZFZhbHVlOiBWLCBrZXk6IEspID0+IHZvaWQpOiB2b2lkO1xyXG4gICAgb25jZShldmVudDogJ2FkZCcsIGNhbGxiYWNrOiAodmFsdWU6IFYsIGtleTogSykgPT4gdm9pZCk6IHZvaWQ7XHJcbiAgICBvbmNlKGV2ZW50OiAncmVtb3ZlJywgY2FsbGJhY2s6ICh2YWx1ZTogViwga2V5OiBLKSA9PiB2b2lkKTogdm9pZDtcclxuICAgIG9uY2UoZXZlbnQ6IGFueSwgY2FsbGJhY2s6IGFueSk6IGFueSB7XHJcbiAgICAgICAgc3VwZXIub25jZShldmVudCwgY2FsbGJhY2spO1xyXG4gICAgfVxyXG5cclxuICAgIG9mZihldmVudDogJ3NldCcsIGNhbGxiYWNrPzogKG5ld1ZhbHVlOiBNYXA8SywgVj4sIG9sZFZhbHVlOiBNYXA8SywgVj4pID0+IHZvaWQpOiB2b2lkO1xyXG4gICAgb2ZmKGV2ZW50OiAnYmVmb3JlU2V0JywgY2FsbGJhY2s/OiAobmV3VmFsdWU6IE1hcDxLLCBWPiwgb2xkVmFsdWU6IE1hcDxLLCBWPiwgY2hhbmdlVG86ICh2YWx1ZTogTWFwPEssIFY+KSA9PiB2b2lkLCBvVmFyOiB0aGlzKSA9PiBib29sZWFuIHwgdm9pZCk6IHZvaWQ7XHJcbiAgICBvZmYoZXZlbnQ6ICd1cGRhdGUnLCBjYWxsYmFjaz86IChuZXdWYWx1ZTogViwgb2xkVmFsdWU6IFYsIGtleTogSykgPT4gdm9pZCk6IHZvaWQ7XHJcbiAgICBvZmYoZXZlbnQ6ICdhZGQnLCBjYWxsYmFjaz86ICh2YWx1ZTogViwga2V5OiBLKSA9PiB2b2lkKTogdm9pZDtcclxuICAgIG9mZihldmVudDogJ3JlbW92ZScsIGNhbGxiYWNrPzogKHZhbHVlOiBWLCBrZXk6IEspID0+IHZvaWQpOiB2b2lkO1xyXG4gICAgb2ZmKGV2ZW50OiBhbnksIGNhbGxiYWNrOiBhbnkpOiBhbnkge1xyXG4gICAgICAgIHN3aXRjaCAoZXZlbnQpIHtcclxuICAgICAgICAgICAgY2FzZSAndXBkYXRlJzpcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrID8gdGhpcy5fb25VcGRhdGUuZGVsZXRlKGNhbGxiYWNrKSA6IHRoaXMuX29uVXBkYXRlLmNsZWFyKCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgJ2FkZCc6XHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjayA/IHRoaXMuX29uQWRkLmRlbGV0ZShjYWxsYmFjaykgOiB0aGlzLl9vbkFkZC5jbGVhcigpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlICdyZW1vdmUnOlxyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2sgPyB0aGlzLl9vblJlbW92ZS5kZWxldGUoY2FsbGJhY2spIDogdGhpcy5fb25SZW1vdmUuY2xlYXIoKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHN1cGVyLm9mZihldmVudCwgY2FsbGJhY2spO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vI2VuZHJlZ2lvblxyXG5cclxuICAgIC8vI3JlZ2lvbiBNYXDkv67mlLnmk43kvZzmlrnms5VcclxuXHJcbiAgICAvKipcclxuICAgICAqIOenu+mZpE1hcOWvueixoeS4reeahOaJgOacieWFg+e0oOOAglxyXG4gICAgICovXHJcbiAgICBjbGVhcigpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5yZWFkb25seSlcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGDlsJ3or5Xkv67mlLnkuIDkuKrlj6ror7vnmoQgJHt0aGlzLmNvbnN0cnVjdG9yLm5hbWV9YCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9vblJlbW92ZS5zaXplID4gMCkge1xyXG4gICAgICAgICAgICB0aGlzLl92YWx1ZS5mb3JFYWNoKCh2YWx1ZSwga2V5KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl92YWx1ZS5kZWxldGUoa2V5KTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX29uUmVtb3ZlLmZvckVhY2goY2FsbGJhY2sgPT4gY2FsbGJhY2sodmFsdWUsIGtleSkpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgdGhpcy5fdmFsdWUuY2xlYXIoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOeUqOS6juenu+mZpCBNYXAg5a+56LGh5Lit5oyH5a6a55qE5YWD57Sg44CCXHJcbiAgICAgKi9cclxuICAgIGRlbGV0ZShrZXk6IEspOiBib29sZWFuIHtcclxuICAgICAgICBpZiAodGhpcy5yZWFkb25seSlcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGDlsJ3or5Xkv67mlLnkuIDkuKrlj6ror7vnmoQgJHt0aGlzLmNvbnN0cnVjdG9yLm5hbWV9YCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9vblJlbW92ZS5zaXplID4gMCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fdmFsdWUuaGFzKGtleSkpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5fdmFsdWUuZ2V0KGtleSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl92YWx1ZS5kZWxldGUoa2V5KTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX29uUmVtb3ZlLmZvckVhY2goY2FsbGJhY2sgPT4gY2FsbGJhY2sodmFsdWUgYXMgViwga2V5KSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl92YWx1ZS5kZWxldGUoa2V5KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOS4uk1hcOWvueixoea3u+WKoOS4gOS4quaMh+WumumUru+8iGtlee+8ieWSjOWAvO+8iHZhbHVl77yJ55qE5paw5YWD57Sg44CCXHJcbiAgICAgKi9cclxuICAgIHNldChrZXk6IEssIHZhbHVlOiBWKTogdGhpcyB7XHJcbiAgICAgICAgaWYgKHRoaXMucmVhZG9ubHkpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihg5bCd6K+V5L+u5pS55LiA5Liq5Y+q6K+755qEICR7dGhpcy5jb25zdHJ1Y3Rvci5uYW1lfWApO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fdmFsdWUuaGFzKGtleSkpIHtcclxuICAgICAgICAgICAgY29uc3Qgb2xkVmFsdWUgPSB0aGlzLl92YWx1ZS5nZXQoa2V5KSBhcyBWO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fdmFsdWUuc2V0KGtleSwgdmFsdWUpO1xyXG4gICAgICAgICAgICB0aGlzLl9vblVwZGF0ZS5mb3JFYWNoKGNhbGxiYWNrID0+IGNhbGxiYWNrKHZhbHVlLCBvbGRWYWx1ZSwga2V5KSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fdmFsdWUuc2V0KGtleSwgdmFsdWUpO1xyXG4gICAgICAgICAgICB0aGlzLl9vbkFkZC5mb3JFYWNoKGNhbGxiYWNrID0+IGNhbGxiYWNrKHZhbHVlLCBrZXkpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIC8vI2VuZHJlZ2lvblxyXG5cclxuICAgIC8vI3JlZ2lvbiBNYXDor7vlj5bmk43kvZzmlrnms5VcclxuXHJcbiAgICAvKipcclxuICAgICAqIOi/lOWbnuS4gOS4quaWsOeahOWMheWQqyBba2V5LCB2YWx1ZV0g5a+555qEIEl0ZXJhdG9yIOWvueixoe+8jOi/lOWbnueahOi/reS7o+WZqOeahOi/reS7o+mhuuW6j+S4jiBNYXAg5a+56LGh55qE5o+S5YWl6aG65bqP55u45ZCM44CCXHJcbiAgICAgKi9cclxuICAgIGVudHJpZXMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlLmVudHJpZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOS7peaPkuWFpemhuuW6j+WvuSBNYXAg5a+56LGh5Lit55qE5q+P5LiA5Liq6ZSu5YC85a+55omn6KGM5LiA5qyh5Y+C5pWw5Lit5o+Q5L6b55qE5Zue6LCD5Ye95pWw44CCXHJcbiAgICAgKi9cclxuICAgIGZvckVhY2goY2FsbGJhY2tmbjogKHZhbHVlOiBWLCBrZXk6IEssIG1hcDogTWFwPEssIFY+KSA9PiB2b2lkLCB0aGlzQXJnPzogYW55KTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5fdmFsdWUuZm9yRWFjaChjYWxsYmFja2ZuLCB0aGlzQXJnKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOeUqOadpeiOt+WPluS4gOS4qiBNYXAg5a+56LGh5Lit5oyH5a6a55qE5YWD57Sg44CCXHJcbiAgICAgKi9cclxuICAgIGdldChrZXk6IEspOiBWIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUuZ2V0KGtleSkgYXMgVjtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOi/lOWbnuS4gOS4qmJvb2zlgLzvvIznlKjmnaXooajmmI5tYXAg5Lit5piv5ZCm5a2Y5Zyo5oyH5a6a5YWD57SgXHJcbiAgICAgKi9cclxuICAgIGhhcyhrZXk6IEspOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUuaGFzKGtleSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDov5Tlm57kuIDkuKrmlrDnmoQgSXRlcmF0b3Ig5a+56LGh44CC5a6D5YyF5ZCr5oyJ54Wn6aG65bqP5o+S5YWlTWFw5a+56LGh5Lit5q+P5Liq5YWD57Sg55qEa2V55YC844CCXHJcbiAgICAgKi9cclxuICAgIGtleXMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlLmtleXMoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOi/lOWbnuS4gOS4quaWsOeahEl0ZXJhdG9y5a+56LGh44CC5a6D5YyF5ZCr5oyJ6aG65bqP5o+S5YWlTWFw5a+56LGh5Lit5q+P5Liq5YWD57Sg55qEdmFsdWXlgLzjgIJcclxuICAgICAqL1xyXG4gICAgdmFsdWVzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl92YWx1ZS52YWx1ZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyNlbmRyZWdpb25cclxufSJdfQ==
