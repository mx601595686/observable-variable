"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const ObservableVariable_1 = require("./ObservableVariable");
/**
 * 可观察改变Map
 */
class ObservableMap extends ObservableVariable_1.ObservableVariable {
    constructor(value) {
        super(value);
        //#endregion
        //#region 属性
        this._onAdd = new Set();
        this._onRemove = new Set();
        if (this !== value)
            if (Array.isArray(value))
                this._value = new Map(value);
    }
    static observe(value, path) {
        if (path === undefined) {
            return new ObservableMap(value);
        }
        else if ('string' === typeof path) {
            path = path.split('.');
        }
        for (let index = 0, end = path.length - 1; index < end; index++) {
            value = value[path[index]];
        }
        value[path[path.length - 1]] = new ObservableMap(value[path[path.length - 1]]);
    }
    /**
     * Map元素个数
     */
    get size() {
        return this._value.size;
    }
    //#endregion
    //#region toJSON
    toJSON() {
        return this.serializable ? [...this._value] : undefined;
    }
    on(event, callback) {
        switch (event) {
            case 'add':
                this._onAdd.add(callback);
                break;
            case 'remove':
                this._onRemove.add(callback);
                break;
            default:
                super.on(event, callback);
                break;
        }
    }
    once(event, callback) {
        super.once(event, callback);
    }
    off(event, callback) {
        switch (event) {
            case 'add':
                callback ? this._onAdd.delete(callback) : this._onAdd.clear();
                break;
            case 'remove':
                callback ? this._onRemove.delete(callback) : this._onRemove.clear();
                break;
            default:
                super.off(event, callback);
                break;
        }
    }
    //#endregion
    //#region Map修改操作方法
    /**
     * 移除Map对象中的所有元素。
     */
    clear() {
        if (this._onRemove.size > 0) {
            this._value.forEach((value, key) => {
                this._value.delete(key);
                this._onRemove.forEach(callback => callback(value, key));
            });
        }
        else
            this._value.clear();
    }
    /**
     * 用于移除 Map 对象中指定的元素。
     */
    delete(key) {
        if (this._onRemove.size > 0) {
            if (this._value.has(key)) {
                const value = this._value.get(key);
                this._value.delete(key);
                this._onRemove.forEach(callback => callback(value, key));
                return true;
            }
            else
                return false;
        }
        else
            return this._value.delete(key);
    }
    /**
     * 为Map对象添加一个指定键（key）和值（value）的新元素。
     */
    set(key, value) {
        if (this._onAdd.size > 0) {
            if (!this._value.has(key)) {
                this._value.set(key, value);
                this._onAdd.forEach(callback => callback(value, key));
            }
            else
                this._value.set(key, value);
        }
        else
            this._value.set(key, value);
        return this;
    }
    //#endregion
    //#region Map读取操作方法
    /**
     * 返回一个新的包含 [key, value] 对的 Iterator 对象，返回的迭代器的迭代顺序与 Map 对象的插入顺序相同。
     */
    entries() {
        return this._value.entries();
    }
    /**
     * 以插入顺序对 Map 对象中的每一个键值对执行一次参数中提供的回调函数。
     */
    forEach(callbackfn, thisArg) {
        this._value.forEach(callbackfn, thisArg);
    }
    /**
     * 用来获取一个 Map 对象中指定的元素。
     */
    get(key) {
        return this._value.get(key);
    }
    /**
     * 返回一个bool值，用来表明map 中是否存在指定元素
     */
    has(key) {
        return this._value.has(key);
    }
    /**
     * 返回一个新的 Iterator 对象。它包含按照顺序插入Map对象中每个元素的key值。
     */
    keys() {
        return this._value.keys();
    }
    /**
     * 返回一个新的Iterator对象。它包含按顺序插入Map对象中每个元素的value值。
     */
    values() {
        return this._value.values();
    }
}
exports.ObservableMap = ObservableMap;
;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk9ic2VydmFibGVEYXRhVHlwZS9PYnNlcnZhYmxlTWFwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsNkRBQXlFO0FBRXpFOztHQUVHO0FBQ0gsbUJBQWlDLFNBQVEsdUNBQTZCO0lBcUNsRSxZQUFZLEtBQThEO1FBQ3RFLEtBQUssQ0FBQyxLQUFZLENBQUMsQ0FBQztRQVJ4QixZQUFZO1FBRVosWUFBWTtRQUVGLFdBQU0sR0FBK0MsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUMvRCxjQUFTLEdBQStDLElBQUksR0FBRyxFQUFFLENBQUM7UUFLeEUsSUFBSSxJQUFJLEtBQUssS0FBSztZQUNkLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUM7Z0JBQ3BCLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDekMsQ0FBQztJQTNCRCxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQVUsRUFBRSxJQUFVO1FBQ2pDLElBQUksSUFBSSxLQUFLLFNBQVMsRUFBRTtZQUNwQixPQUFPLElBQUksYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ25DO2FBQU0sSUFBSSxRQUFRLEtBQUssT0FBTyxJQUFJLEVBQUU7WUFDakMsSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDMUI7UUFFRCxLQUFLLElBQUksS0FBSyxHQUFHLENBQUMsRUFBRSxHQUFHLEdBQUcsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsS0FBSyxHQUFHLEdBQUcsRUFBRSxLQUFLLEVBQUUsRUFBRTtZQUM3RCxLQUFLLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1NBQzlCO1FBRUQsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxhQUFhLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJ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RyxDQUFNLENBQUM7SUFDckMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsR0FBRyxDQUFDLEdBQU07UUFDTixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ2hDLENBQUM7SUFFRDs7T0FFRztJQUNILElBQUk7UUFDQSxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDOUIsQ0FBQztJQUVEOztPQUVHO0lBQ0gsTUFBTTtRQUNGLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUNoQyxDQUFDO0NBR0o7QUF0TkQsc0NBc05DO0FBRWtGLENBQUMiLCJmaWxlIjoiT2JzZXJ2YWJsZURhdGFUeXBlL09ic2VydmFibGVNYXAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPYnNlcnZhYmxlVmFyaWFibGUsIE9uU2V0Q2FsbGJhY2sgfSBmcm9tIFwiLi9PYnNlcnZhYmxlVmFyaWFibGVcIjtcclxuXHJcbi8qKlxyXG4gKiDlj6/op4Llr5/mlLnlj5hNYXBcclxuICovXHJcbmV4cG9ydCBjbGFzcyBPYnNlcnZhYmxlTWFwPEssIFY+IGV4dGVuZHMgT2JzZXJ2YWJsZVZhcmlhYmxlPE1hcDxLLCBWPj4ge1xyXG5cclxuICAgIC8vI3JlZ2lvbiDpnZnmgIHmlrnms5VcclxuXHJcbiAgICAvKipcclxuICAgICAqIOWwhuS4gOS4quaVsOe7hOi9rOaNouaIkOWPr+inguWvn01hcO+8jOebuOW9k+S6jiBuZXcgT2JzZXJ2YWJsZU1hcCh2YWx1ZSlcclxuICAgICAqL1xyXG4gICAgc3RhdGljIG9ic2VydmU8SywgVj4odmFsdWU6IE9ic2VydmFibGVNYXA8SywgVj4gfCBNYXA8SywgVj4gfCBSZWFkb25seUFycmF5PFtLLCBWXT4pOiBPYnNlcnZhYmxlTWFwPEssIFY+O1xyXG4gICAgLyoqXHJcbiAgICAgKiDlsIblr7nosaHkuK3mjIflrprkvY3nva7nmoTkuIDkuKrmlbDnu4TovazmjaLmiJDlj6/op4Llr59NYXDvvIzot6/lvoTpgJrov4dgLmDliIblibJcclxuICAgICAqL1xyXG4gICAgc3RhdGljIG9ic2VydmUob2JqZWN0OiBvYmplY3QsIHBhdGg6IHN0cmluZyk6IHZvaWQ7XHJcbiAgICAvKipcclxuICAgICAqIOWwhuWvueixoeS4reaMh+WumuS9jee9rueahOS4gOS4quaVsOe7hOi9rOaNouaIkOWPr+inguWvn01hcFxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgb2JzZXJ2ZShvYmplY3Q6IG9iamVjdCwgcGF0aDogc3RyaW5nW10pOiB2b2lkO1xyXG4gICAgc3RhdGljIG9ic2VydmUodmFsdWU6IGFueSwgcGF0aD86IGFueSk6IGFueSB7XHJcbiAgICAgICAgaWYgKHBhdGggPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IE9ic2VydmFibGVNYXAodmFsdWUpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoJ3N0cmluZycgPT09IHR5cGVvZiBwYXRoKSB7XHJcbiAgICAgICAgICAgIHBhdGggPSBwYXRoLnNwbGl0KCcuJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IgKGxldCBpbmRleCA9IDAsIGVuZCA9IHBhdGgubGVuZ3RoIC0gMTsgaW5kZXggPCBlbmQ7IGluZGV4KyspIHtcclxuICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZVtwYXRoW2luZGV4XV07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YWx1ZVtwYXRoW3BhdGgubGVuZ3RoIC0gMV1dID0gbmV3IE9ic2VydmFibGVNYXAodmFsdWVbcGF0aFtwYXRoLmxlbmd0aCAtIDFdXSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8jZW5kcmVnaW9uXHJcblxyXG4gICAgLy8jcmVnaW9uIOWxnuaAp1xyXG5cclxuICAgIHByb3RlY3RlZCBfb25BZGQ6IFNldDxPbkFkZE9yUmVtb3ZlTWFwRWxlbWVudENhbGxiYWNrPEssIFY+PiA9IG5ldyBTZXQoKTtcclxuICAgIHByb3RlY3RlZCBfb25SZW1vdmU6IFNldDxPbkFkZE9yUmVtb3ZlTWFwRWxlbWVudENhbGxiYWNrPEssIFY+PiA9IG5ldyBTZXQoKTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcih2YWx1ZTogT2JzZXJ2YWJsZU1hcDxLLCBWPiB8IE1hcDxLLCBWPiB8IFJlYWRvbmx5QXJyYXk8W0ssIFZdPikge1xyXG4gICAgICAgIHN1cGVyKHZhbHVlIGFzIGFueSk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzICE9PSB2YWx1ZSlcclxuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5fdmFsdWUgPSBuZXcgTWFwKHZhbHVlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIE1hcOWFg+e0oOS4quaVsFxyXG4gICAgICovXHJcbiAgICBnZXQgc2l6ZSgpe1xyXG4gICAgICAgIHJldHVybiB0aGlzLl92YWx1ZS5zaXplO1xyXG4gICAgfVxyXG5cclxuICAgIC8vI2VuZHJlZ2lvblxyXG5cclxuICAgIC8vI3JlZ2lvbiB0b0pTT05cclxuXHJcbiAgICBwcm90ZWN0ZWQgdG9KU09OKCk6IGFueSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VyaWFsaXphYmxlID8gWy4uLnRoaXMuX3ZhbHVlXSA6IHVuZGVmaW5lZDtcclxuICAgIH1cclxuXHJcbiAgICAvLyNlbmRyZWdpb25cclxuXHJcbiAgICAvLyNyZWdpb24g5LqL5Lu257uR5a6a5pa55rOVXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlvZPorr7nva7lgLznmoTml7blgJnop6blj5FcclxuICAgICAqL1xyXG4gICAgb24oZXZlbnQ6ICdzZXQnLCBjYWxsYmFjazogT25TZXRDYWxsYmFjazxNYXA8SywgVj4+KTogdm9pZDtcclxuICAgIC8qKlxyXG4gICAgICog5b2T5ZCRTWFw5Lit5re75Yqg5YWD57Sg5pe26Kem5Y+RXHJcbiAgICAgKi9cclxuICAgIG9uKGV2ZW50OiAnYWRkJywgY2FsbGJhY2s6IE9uQWRkT3JSZW1vdmVNYXBFbGVtZW50Q2FsbGJhY2s8SywgVj4pOiB2b2lkO1xyXG4gICAgLyoqXHJcbiAgICAgKiDlvZPliKDpmaRNYXDkuK3lhYPntKDml7bop6blj5FcclxuICAgICAqL1xyXG4gICAgb24oZXZlbnQ6ICdyZW1vdmUnLCBjYWxsYmFjazogT25BZGRPclJlbW92ZU1hcEVsZW1lbnRDYWxsYmFjazxLLCBWPik6IHZvaWQ7XHJcbiAgICBvbihldmVudDogYW55LCBjYWxsYmFjazogYW55KTogYW55IHtcclxuICAgICAgICBzd2l0Y2ggKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ2FkZCc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9vbkFkZC5hZGQoY2FsbGJhY2spO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlICdyZW1vdmUnOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fb25SZW1vdmUuYWRkKGNhbGxiYWNrKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHN1cGVyLm9uKGV2ZW50LCBjYWxsYmFjayk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25jZShldmVudDogJ3NldCcsIGNhbGxiYWNrOiBPblNldENhbGxiYWNrPE1hcDxLLCBWPj4pOiB2b2lkO1xyXG4gICAgb25jZShldmVudDogJ2FkZCcsIGNhbGxiYWNrOiBPbkFkZE9yUmVtb3ZlTWFwRWxlbWVudENhbGxiYWNrPEssIFY+KTogdm9pZDtcclxuICAgIG9uY2UoZXZlbnQ6ICdyZW1vdmUnLCBjYWxsYmFjazogT25BZGRPclJlbW92ZU1hcEVsZW1lbnRDYWxsYmFjazxLLCBWPik6IHZvaWQ7XHJcbiAgICBvbmNlKGV2ZW50OiBhbnksIGNhbGxiYWNrOiBhbnkpOiBhbnkge1xyXG4gICAgICAgIHN1cGVyLm9uY2UoZXZlbnQsIGNhbGxiYWNrKTtcclxuICAgIH1cclxuXHJcbiAgICBvZmYoZXZlbnQ6ICdzZXQnLCBjYWxsYmFjaz86IE9uU2V0Q2FsbGJhY2s8TWFwPEssIFY+Pik6IHZvaWQ7XHJcbiAgICBvZmYoZXZlbnQ6ICdhZGQnLCBjYWxsYmFjaz86IE9uQWRkT3JSZW1vdmVNYXBFbGVtZW50Q2FsbGJhY2s8SywgVj4pOiB2b2lkO1xyXG4gICAgb2ZmKGV2ZW50OiAncmVtb3ZlJywgY2FsbGJhY2s/OiBPbkFkZE9yUmVtb3ZlTWFwRWxlbWVudENhbGxiYWNrPEssIFY+KTogdm9pZDtcclxuICAgIG9mZihldmVudDogYW55LCBjYWxsYmFjazogYW55KTogYW55IHtcclxuICAgICAgICBzd2l0Y2ggKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ2FkZCc6XHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjayA/IHRoaXMuX29uQWRkLmRlbGV0ZShjYWxsYmFjaykgOiB0aGlzLl9vbkFkZC5jbGVhcigpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlICdyZW1vdmUnOlxyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2sgPyB0aGlzLl9vblJlbW92ZS5kZWxldGUoY2FsbGJhY2spIDogdGhpcy5fb25SZW1vdmUuY2xlYXIoKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHN1cGVyLm9mZihldmVudCwgY2FsbGJhY2spO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vI2VuZHJlZ2lvblxyXG5cclxuICAgIC8vI3JlZ2lvbiBNYXDkv67mlLnmk43kvZzmlrnms5VcclxuXHJcbiAgICAvKipcclxuICAgICAqIOenu+mZpE1hcOWvueixoeS4reeahOaJgOacieWFg+e0oOOAglxyXG4gICAgICovXHJcbiAgICBjbGVhcigpOiB2b2lkIHtcclxuICAgICAgICBpZiAodGhpcy5fb25SZW1vdmUuc2l6ZSA+IDApIHtcclxuICAgICAgICAgICAgdGhpcy5fdmFsdWUuZm9yRWFjaCgodmFsdWUsIGtleSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fdmFsdWUuZGVsZXRlKGtleSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9vblJlbW92ZS5mb3JFYWNoKGNhbGxiYWNrID0+IGNhbGxiYWNrKHZhbHVlLCBrZXkpKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgIHRoaXMuX3ZhbHVlLmNsZWFyKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDnlKjkuo7np7vpmaQgTWFwIOWvueixoeS4reaMh+WumueahOWFg+e0oOOAglxyXG4gICAgICovXHJcbiAgICBkZWxldGUoa2V5OiBLKTogYm9vbGVhbiB7XHJcbiAgICAgICAgaWYgKHRoaXMuX29uUmVtb3ZlLnNpemUgPiAwKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl92YWx1ZS5oYXMoa2V5KSkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLl92YWx1ZS5nZXQoa2V5KTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3ZhbHVlLmRlbGV0ZShrZXkpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fb25SZW1vdmUuZm9yRWFjaChjYWxsYmFjayA9PiBjYWxsYmFjayh2YWx1ZSBhcyBWLCBrZXkpKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlLmRlbGV0ZShrZXkpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Li6TWFw5a+56LGh5re75Yqg5LiA5Liq5oyH5a6a6ZSu77yIa2V577yJ5ZKM5YC877yIdmFsdWXvvInnmoTmlrDlhYPntKDjgIJcclxuICAgICAqL1xyXG4gICAgc2V0KGtleTogSywgdmFsdWU6IFYpOiB0aGlzIHtcclxuICAgICAgICBpZiAodGhpcy5fb25BZGQuc2l6ZSA+IDApIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLl92YWx1ZS5oYXMoa2V5KSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fdmFsdWUuc2V0KGtleSwgdmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fb25BZGQuZm9yRWFjaChjYWxsYmFjayA9PiBjYWxsYmFjayh2YWx1ZSwga2V5KSk7XHJcbiAgICAgICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICAgICAgdGhpcy5fdmFsdWUuc2V0KGtleSwgdmFsdWUpO1xyXG4gICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICB0aGlzLl92YWx1ZS5zZXQoa2V5LCB2YWx1ZSk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIC8vI2VuZHJlZ2lvblxyXG5cclxuICAgIC8vI3JlZ2lvbiBNYXDor7vlj5bmk43kvZzmlrnms5VcclxuXHJcbiAgICAvKipcclxuICAgICAqIOi/lOWbnuS4gOS4quaWsOeahOWMheWQqyBba2V5LCB2YWx1ZV0g5a+555qEIEl0ZXJhdG9yIOWvueixoe+8jOi/lOWbnueahOi/reS7o+WZqOeahOi/reS7o+mhuuW6j+S4jiBNYXAg5a+56LGh55qE5o+S5YWl6aG65bqP55u45ZCM44CCXHJcbiAgICAgKi9cclxuICAgIGVudHJpZXMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlLmVudHJpZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOS7peaPkuWFpemhuuW6j+WvuSBNYXAg5a+56LGh5Lit55qE5q+P5LiA5Liq6ZSu5YC85a+55omn6KGM5LiA5qyh5Y+C5pWw5Lit5o+Q5L6b55qE5Zue6LCD5Ye95pWw44CCXHJcbiAgICAgKi9cclxuICAgIGZvckVhY2goY2FsbGJhY2tmbjogKHZhbHVlOiBWLCBrZXk6IEssIG1hcDogTWFwPEssIFY+KSA9PiB2b2lkLCB0aGlzQXJnPzogYW55KTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5fdmFsdWUuZm9yRWFjaChjYWxsYmFja2ZuLCB0aGlzQXJnKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOeUqOadpeiOt+WPluS4gOS4qiBNYXAg5a+56LGh5Lit5oyH5a6a55qE5YWD57Sg44CCXHJcbiAgICAgKi9cclxuICAgIGdldChrZXk6IEspOiBWIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUuZ2V0KGtleSkgYXMgVjtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOi/lOWbnuS4gOS4qmJvb2zlgLzvvIznlKjmnaXooajmmI5tYXAg5Lit5piv5ZCm5a2Y5Zyo5oyH5a6a5YWD57SgXHJcbiAgICAgKi9cclxuICAgIGhhcyhrZXk6IEspOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUuaGFzKGtleSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDov5Tlm57kuIDkuKrmlrDnmoQgSXRlcmF0b3Ig5a+56LGh44CC5a6D5YyF5ZCr5oyJ54Wn6aG65bqP5o+S5YWlTWFw5a+56LGh5Lit5q+P5Liq5YWD57Sg55qEa2V55YC844CCXHJcbiAgICAgKi9cclxuICAgIGtleXMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlLmtleXMoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOi/lOWbnuS4gOS4quaWsOeahEl0ZXJhdG9y5a+56LGh44CC5a6D5YyF5ZCr5oyJ6aG65bqP5o+S5YWlTWFw5a+56LGh5Lit5q+P5Liq5YWD57Sg55qEdmFsdWXlgLzjgIJcclxuICAgICAqL1xyXG4gICAgdmFsdWVzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl92YWx1ZS52YWx1ZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyNlbmRyZWdpb25cclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBPbkFkZE9yUmVtb3ZlTWFwRWxlbWVudENhbGxiYWNrPEssIFY+IHsgKHZhbHVlOiBWLCBrZXk6IEspOiB2b2lkIH07Il19
