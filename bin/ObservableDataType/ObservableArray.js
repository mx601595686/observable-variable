"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const ObservableVariable_1 = require("./ObservableVariable");
/**
 * 可观察改变数组
 */
class ObservableArray extends ObservableVariable_1.ObservableVariable {
    constructor(value) {
        super(value);
        //#endregion
        //#region 属性
        this._onAdd = new Set();
        this._onRemove = new Set();
    }
    static observe(value, path) {
        if (path === undefined) {
            return new ObservableArray(value);
        }
        else if ('string' === typeof path) {
            path = path.split('.');
        }
        for (let index = 0, end = path.length - 1; index < end; index++) {
            value = value[path[index]];
        }
        value[path[path.length - 1]] = new ObservableArray(value[path[path.length - 1]]);
    }
    /**
     * 数组的长度
     */
    get length() {
        return this._value.length;
    }
    set length(v) {
        this._value.length = v;
    }
    on(event, callback) {
        switch (event) {
            case 'add':
                this._onAdd.add(callback);
                break;
            case 'remove':
                this._onRemove.add(callback);
                break;
            default:
                super.on(event, callback);
                break;
        }
    }
    once(event, callback) {
        super.once(event, callback);
    }
    off(event, callback) {
        switch (event) {
            case 'add':
                callback ? this._onAdd.delete(callback) : this._onAdd.clear();
                break;
            case 'remove':
                callback ? this._onRemove.delete(callback) : this._onRemove.clear();
                break;
            default:
                super.off(event, callback);
                break;
        }
    }
    //#endregion
    //#region 数组修改操作方法
    /**
     * 从数组中删除最后一个元素，并返回该元素的值。此方法更改数组的长度。
     */
    pop() {
        if (this._onRemove.size > 0) {
            const originalLength = this._value.length;
            const result = this._value.pop();
            if (originalLength > this._value.length)
                this._onRemove.forEach(callback => callback(result));
            return result;
        }
        else
            return this._value.pop();
    }
    /**
     * 将一个或多个元素添加到数组的末尾，并返回新数组的长度。
     */
    push(...items) {
        if (this._onAdd.size > 0) {
            items.forEach(item => {
                this._value.push(item);
                this._onAdd.forEach(callback => callback(item));
            });
            return this._value.length;
        }
        else
            return this._value.push(...items);
    }
    /**
     * 从数组中删除第一个元素，并返回该元素的值。此方法更改数组的长度。
     */
    shift() {
        if (this._onRemove.size > 0) {
            const originalLength = this._value.length;
            const result = this._value.shift();
            if (originalLength > this._value.length)
                this._onRemove.forEach(callback => callback(result));
            return result;
        }
        else
            return this._value.shift();
    }
    /**
     * 将一个或多个元素添加到数组的开头，并返回新数组的长度。
     */
    unshift(...items) {
        if (this._onAdd.size > 0) {
            items.forEach((item, index) => {
                this._value.splice(index, 0, item);
                this._onAdd.forEach(callback => callback(item));
            });
            return this._value.length;
        }
        else
            return this._value.unshift(...items);
    }
    splice(start, deleteCount, ...items) {
        if (this._onAdd.size > 0 || this._onRemove.size > 0) {
            let deleteElements = []; //被删除的元素
            start = Math.trunc(start);
            start = start < 0 ? Math.max(this._value.length + start, 0) : Math.min(start, this._value.length);
            if (this._onRemove.size > 0) {
                deleteCount = deleteCount === undefined ? this._value.length - start : deleteCount < 0 ? 0 : Math.min(Math.trunc(deleteCount), this._value.length - start);
                for (let index = 0; index < deleteCount; index++) {
                    const element = this._value.splice(start, 1)[0];
                    this._onRemove.forEach(callback => callback(element));
                    deleteElements.push(element);
                }
            }
            else
                deleteElements = this._value.splice(start, deleteCount);
            if (this._onAdd.size > 0) {
                items.forEach((item, index) => {
                    this._value.splice(start + index, 0, item);
                    this._onAdd.forEach(callback => callback(item));
                });
            }
            else
                this._value.splice(start, 0, ...items);
            return deleteElements;
        }
        else
            return this._value.splice(start, deleteCount, ...items);
    }
    /**
     * 删除数组中第一个与之匹配的元素
     * @param value 要被删除的值
     */
    delete(value) {
        const index = this._value.indexOf(value);
        if (index !== -1) {
            this._value.splice(index, 1);
            if (this._onRemove.size > 0)
                this._onRemove.forEach(callback => callback(value));
            return true;
        }
        else
            return false;
    }
    /**
     * 删除数组中所有与之匹配的元素
     * @param value 要被删除的值
     */
    deleteAll(value) {
        while (this.delete(value))
            ;
    }
    /**
     * 排序数组。注意，排序完成之后将触发onSet事件
     * @param compareFn 排序方法
     */
    sort(compareFn) {
        this._value.sort(compareFn);
        if (this._onSet.size > 0)
            this._onSet.forEach(callback => callback(this._value, this._value));
        return this;
    }
    /**
     * 反转数组中元素顺序。注意，反转完成之后将触发onSet事件
     */
    reverse() {
        this._value.reverse();
        if (this._onSet.size > 0)
            this._onSet.forEach(callback => callback(this._value, this._value));
        return this;
    }
    /**
     * 将数组中指定部分的值填充为指定值。注意，填充完成之后将触发onSet事件
     * @param value 要填充的值
     * @param start 开始位置
     * @param end 结束位置
     */
    fill(value, start, end) {
        this._value.fill(value, start, end);
        if (this._onSet.size > 0)
            this._onSet.forEach(callback => callback(this._value, this._value));
        return this;
    }
    /**
     * 浅复制数组的一部分到同一数组中的另一个位置，并返回它，而不修改其大小。注意，完成之后将触发onSet事件
     */
    copyWithin(target, start, end) {
        this._value.copyWithin(target, start, end);
        if (this._onSet.size > 0)
            this._onSet.forEach(callback => callback(this._value, this._value));
        return this;
    }
    //#endregion
    //#region 数组读取操作方法
    /**
     * 用于合并两个或多个数组。此方法不会更改现有数组，而是返回一个新数组。
     */
    concat(...items) {
        return this._value.concat(...items);
    }
    /**
     * 返回一个新的Array Iterator对象，该对象包含数组中每个索引的键/值对。
     */
    entries() {
        return this._value.entries();
    }
    /**
     * 测试数组的所有元素是否都通过了指定函数的测试。
     */
    every(callbackfn, thisArg) {
        return this._value.every(callbackfn, thisArg);
    }
    filter(callbackfn, thisArg) {
        return this._value.filter(callbackfn, thisArg);
    }
    find(predicate, thisArg) {
        return this._value.find(predicate, thisArg);
    }
    /**
     * 返回数组中满足提供的测试函数的第一个元素的索引。否则返回-1。
     */
    findIndex(predicate, thisArg) {
        return this._value.findIndex(predicate);
    }
    /**
     * 对数组的每个元素执行一次提供的函数。
     */
    forEach(callbackfn, thisArg) {
        this._value.forEach(callbackfn);
    }
    /**
     * 用来判断一个数组是否包含一个指定的值，根据情况，如果包含则返回 true，否则返回false。
     */
    includes(searchElement, fromIndex) {
        return this._value.includes(searchElement, fromIndex);
    }
    /**
     * 返回在数组中可以找到一个给定元素的第一个索引，如果不存在，则返回-1。
     */
    indexOf(searchElement, fromIndex) {
        return this._value.indexOf(searchElement, fromIndex);
    }
    /**
     * 方法将一个数组（或一个类数组对象）的所有元素连接成一个字符串并返回这个字符串。
     */
    join(separator) {
        return this._value.join(separator);
    }
    /**
     * 返回一个新的Array迭代器，它包含数组中每个索引的键。
     */
    keys() {
        return this._value.keys();
    }
    /**
     * 返回指定元素（也即有效的 JavaScript 值或变量）在数组中的最后一个的索引，如果不存在则返回 -1。从数组的后面向前查找，从 fromIndex 处开始。
     */
    lastIndexOf(searchElement, fromIndex) {
        return this._value.lastIndexOf(searchElement, fromIndex);
    }
    /**
     * 创建一个新数组，其结果是该数组中的每个元素都调用一个提供的函数后返回的结果。
     */
    map(callbackfn, thisArg) {
        return this._value.map(callbackfn);
    }
    reduce(callbackfn, initialValue) {
        return this._value.reduce(callbackfn, initialValue);
    }
    reduceRight(callbackfn, initialValue) {
        return this._value.reduceRight(callbackfn, initialValue);
    }
    /**
     * 返回一个从开始到结束（不包括结束）选择的数组的一部分浅拷贝到一个新数组对象。且原始数组不会被修改。
     */
    slice(start, end) {
        return this._value.slice(start, end);
    }
    /**
     * 测试数组中的某些元素是否通过由提供的函数实现的测试。
     */
    some(callbackfn, thisArg) {
        return this._value.some(callbackfn, thisArg);
    }
    /**
     * 返回一个字符串表示数组中的元素。数组中的元素将使用各自的 toLocaleString 方法转成字符串，这些字符串将使用一个特定语言环境的字符串（例如一个逗号 ","）隔开。
     */
    toLocaleString() {
        return this._value.toLocaleString();
    }
    /**
     * 返回一个字符串，表示指定的数组及其元素。
     */
    toString() {
        return this._value.toString();
    }
    /**
     * 返回一个新的 Array Iterator 对象，该对象包含数组每个索引的值
     */
    values() {
        return this._value.values();
    }
}
exports.ObservableArray = ObservableArray;
;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk9ic2VydmFibGVEYXRhVHlwZS9PYnNlcnZhYmxlQXJyYXkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw2REFBeUU7QUFFekU7O0dBRUc7QUFDSCxxQkFBZ0MsU0FBUSx1Q0FBdUI7SUFxQzNELFlBQVksS0FBK0I7UUFDdkMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBUmpCLFlBQVk7UUFFWixZQUFZO1FBRUYsV0FBTSxHQUE4QyxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQzlELGNBQVMsR0FBOEMsSUFBSSxHQUFHLEVBQUUsQ0FBQztJQUkzRSxDQUFDO0lBdkJELE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBVSxFQUFFLElBQVU7UUFDakMsSUFBSSxJQUFJLEtBQUssU0FBUyxFQUFFO1lBQ3BCLE9BQU8sSUFBSSxlQUFlLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDckM7YUFBTSxJQUFJLFFBQVEsS0FBSyxPQUFPLElBQUksRUFBRTtZQUNqQyxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUMxQjtRQUVELEtBQUssSUFBSSxLQUFLLEdBQUcsQ0FBQyxFQUFFLEdBQUcsR0FBRyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxLQUFLLEdBQUcsR0FBRyxFQUFFLEtBQUssRUFBRSxFQUFFO1lBQzdELEtBQUssR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7U0FDOUI7UUFFRCxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLGVBQWUsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3JGLENBQUM7SUFhRDs7T0FFRztJQUNILElBQUksTUFBTTtRQUNOLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUM7SUFD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SUFRRCxNQUFNLENBQUMsVUFBZSxFQUFFLFlBQWtCO1FBQ3RDLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsVUFBVSxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBQ3hELENBQUM7SUFRRCxXQUFXLENBQUMsVUFBZSxFQUFFLFlBQWtCO1FBQzNDLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsVUFBVSxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBQzdELENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxLQUFjLEVBQUUsR0FBWTtRQUM5QixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztJQUN6QyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxJQUFJLENBQUMsVUFBNEQsRUFBRSxPQUFhO1FBQzVFLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ2pELENBQUM7SUFFRDs7T0FFRztJQUNILGNBQWM7UUFDVixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsY0FBYyxFQUFFLENBQUM7SUFDeEMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsUUFBUTtRQUNKLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUNsQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxNQUFNO1FBQ0YsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ2hDLENBQUM7Q0FJSjtBQXJjRCwwQ0FxY0M7QUFDeUUsQ0FBQyIsImZpbGUiOiJPYnNlcnZhYmxlRGF0YVR5cGUvT2JzZXJ2YWJsZUFycmF5LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT2JzZXJ2YWJsZVZhcmlhYmxlLCBPblNldENhbGxiYWNrIH0gZnJvbSBcIi4vT2JzZXJ2YWJsZVZhcmlhYmxlXCI7XHJcblxyXG4vKipcclxuICog5Y+v6KeC5a+f5pS55Y+Y5pWw57uEXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgT2JzZXJ2YWJsZUFycmF5PFQ+IGV4dGVuZHMgT2JzZXJ2YWJsZVZhcmlhYmxlPFRbXT4ge1xyXG5cclxuICAgIC8vI3JlZ2lvbiDpnZnmgIHmlrnms5VcclxuXHJcbiAgICAvKipcclxuICAgICAqIOWwhuS4gOS4quaVsOe7hOi9rOaNouaIkOWPr+inguWvn+aVsOe7hO+8jOebuOW9k+S6jiBuZXcgT2JzZXJ2YWJsZUFycmF5KHZhbHVlKVxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgb2JzZXJ2ZTxUPih2YWx1ZTogT2JzZXJ2YWJsZUFycmF5PFQ+IHwgVFtdKTogT2JzZXJ2YWJsZUFycmF5PFQ+O1xyXG4gICAgLyoqXHJcbiAgICAgKiDlsIblr7nosaHkuK3mjIflrprkvY3nva7nmoTkuIDkuKrmlbDnu4TovazmjaLmiJDlj6/op4Llr5/mlbDnu4TvvIzot6/lvoTpgJrov4dgLmDliIblibJcclxuICAgICAqL1xyXG4gICAgc3RhdGljIG9ic2VydmUob2JqZWN0OiBvYmplY3QsIHBhdGg6IHN0cmluZyk6IHZvaWQ7XHJcbiAgICAvKipcclxuICAgICAqIOWwhuWvueixoeS4reaMh+WumuS9jee9rueahOS4gOS4quaVsOe7hOi9rOaNouaIkOWPr+inguWvn+aVsOe7hFxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgb2JzZXJ2ZShvYmplY3Q6IG9iamVjdCwgcGF0aDogc3RyaW5nW10pOiB2b2lkO1xyXG4gICAgc3RhdGljIG9ic2VydmUodmFsdWU6IGFueSwgcGF0aD86IGFueSk6IGFueSB7XHJcbiAgICAgICAgaWYgKHBhdGggPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IE9ic2VydmFibGVBcnJheSh2YWx1ZSk7XHJcbiAgICAgICAgfSBlbHNlIGlmICgnc3RyaW5nJyA9PT0gdHlwZW9mIHBhdGgpIHtcclxuICAgICAgICAgICAgcGF0aCA9IHBhdGguc3BsaXQoJy4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvciAobGV0IGluZGV4ID0gMCwgZW5kID0gcGF0aC5sZW5ndGggLSAxOyBpbmRleCA8IGVuZDsgaW5kZXgrKykge1xyXG4gICAgICAgICAgICB2YWx1ZSA9IHZhbHVlW3BhdGhbaW5kZXhdXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhbHVlW3BhdGhbcGF0aC5sZW5ndGggLSAxXV0gPSBuZXcgT2JzZXJ2YWJsZUFycmF5KHZhbHVlW3BhdGhbcGF0aC5sZW5ndGggLSAxXV0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vI2VuZHJlZ2lvblxyXG5cclxuICAgIC8vI3JlZ2lvbiDlsZ7mgKdcclxuXHJcbiAgICBwcm90ZWN0ZWQgX29uQWRkOiBTZXQ8T25BZGRPclJlbW92ZUFycmF5RWxlbWVudENhbGxiYWNrPFQ+PiA9IG5ldyBTZXQoKTtcclxuICAgIHByb3RlY3RlZCBfb25SZW1vdmU6IFNldDxPbkFkZE9yUmVtb3ZlQXJyYXlFbGVtZW50Q2FsbGJhY2s8VD4+ID0gbmV3IFNldCgpO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHZhbHVlOiBPYnNlcnZhYmxlQXJyYXk8VD4gfCBUW10pIHtcclxuICAgICAgICBzdXBlcih2YWx1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmlbDnu4TnmoTplb/luqZcclxuICAgICAqL1xyXG4gICAgZ2V0IGxlbmd0aCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUubGVuZ3RoO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBsZW5ndGgodjogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy5fdmFsdWUubGVuZ3RoID0gdjtcclxuICAgIH1cclxuXHJcbiAgICAvLyNlbmRyZWdpb25cclxuXHJcbiAgICAvLyNyZWdpb24g5LqL5Lu257uR5a6a5pa55rOVXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlvZPorr7nva7lgLznmoTml7blgJnop6blj5FcclxuICAgICAqL1xyXG4gICAgb24oZXZlbnQ6ICdzZXQnLCBjYWxsYmFjazogT25TZXRDYWxsYmFjazxUW10+KTogdm9pZDtcclxuICAgIC8qKlxyXG4gICAgICog5b2T5ZCR5pWw57uE5Lit5re75Yqg5YWD57Sg5pe26Kem5Y+RXHJcbiAgICAgKi9cclxuICAgIG9uKGV2ZW50OiAnYWRkJywgY2FsbGJhY2s6IE9uQWRkT3JSZW1vdmVBcnJheUVsZW1lbnRDYWxsYmFjazxUPik6IHZvaWQ7XHJcbiAgICAvKipcclxuICAgICAqIOW9k+WIoOmZpOaVsOe7hOS4reWFg+e0oOaXtuinpuWPkVxyXG4gICAgICovXHJcbiAgICBvbihldmVudDogJ3JlbW92ZScsIGNhbGxiYWNrOiBPbkFkZE9yUmVtb3ZlQXJyYXlFbGVtZW50Q2FsbGJhY2s8VD4pOiB2b2lkO1xyXG4gICAgb24oZXZlbnQ6IGFueSwgY2FsbGJhY2s6IGFueSk6IGFueSB7XHJcbiAgICAgICAgc3dpdGNoIChldmVudCkge1xyXG4gICAgICAgICAgICBjYXNlICdhZGQnOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fb25BZGQuYWRkKGNhbGxiYWNrKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSAncmVtb3ZlJzpcclxuICAgICAgICAgICAgICAgIHRoaXMuX29uUmVtb3ZlLmFkZChjYWxsYmFjayk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICBzdXBlci5vbihldmVudCwgY2FsbGJhY2spO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uY2UoZXZlbnQ6ICdzZXQnLCBjYWxsYmFjazogT25TZXRDYWxsYmFjazxUW10+KTogdm9pZDtcclxuICAgIG9uY2UoZXZlbnQ6ICdhZGQnLCBjYWxsYmFjazogT25BZGRPclJlbW92ZUFycmF5RWxlbWVudENhbGxiYWNrPFQ+KTogdm9pZDtcclxuICAgIG9uY2UoZXZlbnQ6ICdyZW1vdmUnLCBjYWxsYmFjazogT25BZGRPclJlbW92ZUFycmF5RWxlbWVudENhbGxiYWNrPFQ+KTogdm9pZDtcclxuICAgIG9uY2UoZXZlbnQ6IGFueSwgY2FsbGJhY2s6IGFueSk6IGFueSB7XHJcbiAgICAgICAgc3VwZXIub25jZShldmVudCwgY2FsbGJhY2spO1xyXG4gICAgfVxyXG5cclxuICAgIG9mZihldmVudDogJ3NldCcsIGNhbGxiYWNrPzogT25TZXRDYWxsYmFjazxUW10+KTogdm9pZDtcclxuICAgIG9mZihldmVudDogJ2FkZCcsIGNhbGxiYWNrPzogT25BZGRPclJlbW92ZUFycmF5RWxlbWVudENhbGxiYWNrPFQ+KTogdm9pZDtcclxuICAgIG9mZihldmVudDogJ3JlbW92ZScsIGNhbGxiYWNrPzogT25BZGRPclJlbW92ZUFycmF5RWxlbWVudENhbGxiYWNrPFQ+KTogdm9pZDtcclxuICAgIG9mZihldmVudDogYW55LCBjYWxsYmFjazogYW55KTogYW55IHtcclxuICAgICAgICBzd2l0Y2ggKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ2FkZCc6XHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjayA/IHRoaXMuX29uQWRkLmRlbGV0ZShjYWxsYmFjaykgOiB0aGlzLl9vbkFkZC5jbGVhcigpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlICdyZW1vdmUnOlxyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2sgPyB0aGlzLl9vblJlbW92ZS5kZWxldGUoY2FsbGJhY2spIDogdGhpcy5fb25SZW1vdmUuY2xlYXIoKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHN1cGVyLm9mZihldmVudCwgY2FsbGJhY2spO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vI2VuZHJlZ2lvblxyXG5cclxuICAgIC8vI3JlZ2lvbiDmlbDnu4Tkv67mlLnmk43kvZzmlrnms5VcclxuXHJcbiAgICAvKipcclxuICAgICAqIOS7juaVsOe7hOS4reWIoOmZpOacgOWQjuS4gOS4quWFg+e0oO+8jOW5tui/lOWbnuivpeWFg+e0oOeahOWAvOOAguatpOaWueazleabtOaUueaVsOe7hOeahOmVv+W6puOAglxyXG4gICAgICovXHJcbiAgICBwb3AoKTogVCB8IHVuZGVmaW5lZCB7XHJcbiAgICAgICAgaWYgKHRoaXMuX29uUmVtb3ZlLnNpemUgPiAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsTGVuZ3RoID0gdGhpcy5fdmFsdWUubGVuZ3RoO1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLl92YWx1ZS5wb3AoKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChvcmlnaW5hbExlbmd0aCA+IHRoaXMuX3ZhbHVlLmxlbmd0aClcclxuICAgICAgICAgICAgICAgIHRoaXMuX29uUmVtb3ZlLmZvckVhY2goY2FsbGJhY2sgPT4gY2FsbGJhY2socmVzdWx0IGFzIFQpKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl92YWx1ZS5wb3AoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWwhuS4gOS4quaIluWkmuS4quWFg+e0oOa3u+WKoOWIsOaVsOe7hOeahOacq+Wwvu+8jOW5tui/lOWbnuaWsOaVsOe7hOeahOmVv+W6puOAglxyXG4gICAgICovXHJcbiAgICBwdXNoKC4uLml0ZW1zOiBUW10pOiBudW1iZXIge1xyXG4gICAgICAgIGlmICh0aGlzLl9vbkFkZC5zaXplID4gMCkge1xyXG4gICAgICAgICAgICBpdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fdmFsdWUucHVzaChpdGVtKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX29uQWRkLmZvckVhY2goY2FsbGJhY2sgPT4gY2FsbGJhY2soaXRlbSkpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl92YWx1ZS5sZW5ndGg7XHJcbiAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl92YWx1ZS5wdXNoKC4uLml0ZW1zKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOS7juaVsOe7hOS4reWIoOmZpOesrOS4gOS4quWFg+e0oO+8jOW5tui/lOWbnuivpeWFg+e0oOeahOWAvOOAguatpOaWueazleabtOaUueaVsOe7hOeahOmVv+W6puOAglxyXG4gICAgICovXHJcbiAgICBzaGlmdCgpOiBUIHwgdW5kZWZpbmVkIHtcclxuICAgICAgICBpZiAodGhpcy5fb25SZW1vdmUuc2l6ZSA+IDApIHtcclxuICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxMZW5ndGggPSB0aGlzLl92YWx1ZS5sZW5ndGg7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuX3ZhbHVlLnNoaWZ0KCk7XHJcblxyXG4gICAgICAgICAgICBpZiAob3JpZ2luYWxMZW5ndGggPiB0aGlzLl92YWx1ZS5sZW5ndGgpXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9vblJlbW92ZS5mb3JFYWNoKGNhbGxiYWNrID0+IGNhbGxiYWNrKHJlc3VsdCBhcyBUKSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUuc2hpZnQoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWwhuS4gOS4quaIluWkmuS4quWFg+e0oOa3u+WKoOWIsOaVsOe7hOeahOW8gOWktO+8jOW5tui/lOWbnuaWsOaVsOe7hOeahOmVv+W6puOAglxyXG4gICAgICovXHJcbiAgICB1bnNoaWZ0KC4uLml0ZW1zOiBUW10pOiBudW1iZXIge1xyXG4gICAgICAgIGlmICh0aGlzLl9vbkFkZC5zaXplID4gMCkge1xyXG4gICAgICAgICAgICBpdGVtcy5mb3JFYWNoKChpdGVtLCBpbmRleCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fdmFsdWUuc3BsaWNlKGluZGV4LCAwLCBpdGVtKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX29uQWRkLmZvckVhY2goY2FsbGJhY2sgPT4gY2FsbGJhY2soaXRlbSkpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl92YWx1ZS5sZW5ndGg7XHJcbiAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl92YWx1ZS51bnNoaWZ0KC4uLml0ZW1zKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOS7juaMh+WumuS9jee9ruW8gOWni+WIoOmZpOaVsOe7hOWJqeS4i+eahOWFg+e0oFxyXG4gICAgICogQHBhcmFtIHN0YXJ0IOS7juWTquW8gOWni+WIoOmZpOWFg+e0oFxyXG4gICAgICovXHJcbiAgICBzcGxpY2Uoc3RhcnQ6IG51bWJlciwgZGVsZXRlQ291bnQ/OiBudW1iZXIpOiBUW107XHJcbiAgICAvKipcclxuICAgICAqIOaUueWPmOaVsOe7hOeahOWGheWuue+8jOmAmui/h+enu+mZpOaIlua3u+WKoOaWsOWFg+e0oFxyXG4gICAgICogQHBhcmFtIHN0YXJ0IOS7juWTquW8gOWni+WIoOmZpOWFg+e0oFxyXG4gICAgICogQHBhcmFtIGRlbGV0ZUNvdW50IOWIoOmZpOWkmuWwkeS4quWFg+e0oFxyXG4gICAgICogQHBhcmFtIGl0ZW1zIOimgeaPkuWFpeeahOWFg+e0oFxyXG4gICAgICovXHJcbiAgICBzcGxpY2Uoc3RhcnQ6IG51bWJlciwgZGVsZXRlQ291bnQ6IG51bWJlciwgLi4uaXRlbXM6IFRbXSk6IFRbXTtcclxuICAgIHNwbGljZShzdGFydDogbnVtYmVyLCBkZWxldGVDb3VudD86IG51bWJlciwgLi4uaXRlbXM6IFRbXSk6IFRbXSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX29uQWRkLnNpemUgPiAwIHx8IHRoaXMuX29uUmVtb3ZlLnNpemUgPiAwKSB7XHJcbiAgICAgICAgICAgIGxldCBkZWxldGVFbGVtZW50czogVFtdID0gW107ICAvL+iiq+WIoOmZpOeahOWFg+e0oFxyXG5cclxuICAgICAgICAgICAgc3RhcnQgPSBNYXRoLnRydW5jKHN0YXJ0KTtcclxuICAgICAgICAgICAgc3RhcnQgPSBzdGFydCA8IDAgPyBNYXRoLm1heCh0aGlzLl92YWx1ZS5sZW5ndGggKyBzdGFydCwgMCkgOiBNYXRoLm1pbihzdGFydCwgdGhpcy5fdmFsdWUubGVuZ3RoKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9vblJlbW92ZS5zaXplID4gMCkge1xyXG4gICAgICAgICAgICAgICAgZGVsZXRlQ291bnQgPSBkZWxldGVDb3VudCA9PT0gdW5kZWZpbmVkID8gdGhpcy5fdmFsdWUubGVuZ3RoIC0gc3RhcnQgOiBkZWxldGVDb3VudCA8IDAgPyAwIDogTWF0aC5taW4oTWF0aC50cnVuYyhkZWxldGVDb3VudCksIHRoaXMuX3ZhbHVlLmxlbmd0aCAtIHN0YXJ0KTtcclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgZGVsZXRlQ291bnQ7IGluZGV4KyspIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5fdmFsdWUuc3BsaWNlKHN0YXJ0LCAxKVswXTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9vblJlbW92ZS5mb3JFYWNoKGNhbGxiYWNrID0+IGNhbGxiYWNrKGVsZW1lbnQpKTtcclxuICAgICAgICAgICAgICAgICAgICBkZWxldGVFbGVtZW50cy5wdXNoKGVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgIGRlbGV0ZUVsZW1lbnRzID0gdGhpcy5fdmFsdWUuc3BsaWNlKHN0YXJ0LCBkZWxldGVDb3VudCk7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5fb25BZGQuc2l6ZSA+IDApIHtcclxuICAgICAgICAgICAgICAgIGl0ZW1zLmZvckVhY2goKGl0ZW0sIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdmFsdWUuc3BsaWNlKHN0YXJ0ICsgaW5kZXgsIDAsIGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX29uQWRkLmZvckVhY2goY2FsbGJhY2sgPT4gY2FsbGJhY2soaXRlbSkpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICAgICAgdGhpcy5fdmFsdWUuc3BsaWNlKHN0YXJ0LCAwLCAuLi5pdGVtcyk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVsZXRlRWxlbWVudHM7XHJcbiAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl92YWx1ZS5zcGxpY2Uoc3RhcnQsIGRlbGV0ZUNvdW50IGFzIG51bWJlciwgLi4uaXRlbXMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Yig6Zmk5pWw57uE5Lit56ys5LiA5Liq5LiO5LmL5Yy56YWN55qE5YWD57SgXHJcbiAgICAgKiBAcGFyYW0gdmFsdWUg6KaB6KKr5Yig6Zmk55qE5YC8XHJcbiAgICAgKi9cclxuICAgIGRlbGV0ZSh2YWx1ZTogVCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5fdmFsdWUuaW5kZXhPZih2YWx1ZSk7XHJcblxyXG4gICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcclxuICAgICAgICAgICAgdGhpcy5fdmFsdWUuc3BsaWNlKGluZGV4LCAxKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9vblJlbW92ZS5zaXplID4gMClcclxuICAgICAgICAgICAgICAgIHRoaXMuX29uUmVtb3ZlLmZvckVhY2goY2FsbGJhY2sgPT4gY2FsbGJhY2sodmFsdWUpKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliKDpmaTmlbDnu4TkuK3miYDmnInkuI7kuYvljLnphY3nmoTlhYPntKBcclxuICAgICAqIEBwYXJhbSB2YWx1ZSDopoHooqvliKDpmaTnmoTlgLxcclxuICAgICAqL1xyXG4gICAgZGVsZXRlQWxsKHZhbHVlOiBUKTogdm9pZCB7XHJcbiAgICAgICAgd2hpbGUgKHRoaXMuZGVsZXRlKHZhbHVlKSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmjpLluo/mlbDnu4TjgILms6jmhI/vvIzmjpLluo/lrozmiJDkuYvlkI7lsIbop6blj5FvblNldOS6i+S7tlxyXG4gICAgICogQHBhcmFtIGNvbXBhcmVGbiDmjpLluo/mlrnms5VcclxuICAgICAqL1xyXG4gICAgc29ydChjb21wYXJlRm4/OiAoYTogVCwgYjogVCkgPT4gbnVtYmVyKTogdGhpcyB7XHJcbiAgICAgICAgdGhpcy5fdmFsdWUuc29ydChjb21wYXJlRm4pO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fb25TZXQuc2l6ZSA+IDApXHJcbiAgICAgICAgICAgIHRoaXMuX29uU2V0LmZvckVhY2goY2FsbGJhY2sgPT4gY2FsbGJhY2sodGhpcy5fdmFsdWUsIHRoaXMuX3ZhbHVlKSk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Y+N6L2s5pWw57uE5Lit5YWD57Sg6aG65bqP44CC5rOo5oSP77yM5Y+N6L2s5a6M5oiQ5LmL5ZCO5bCG6Kem5Y+Rb25TZXTkuovku7ZcclxuICAgICAqL1xyXG4gICAgcmV2ZXJzZSgpOiB0aGlzIHtcclxuICAgICAgICB0aGlzLl92YWx1ZS5yZXZlcnNlKCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9vblNldC5zaXplID4gMClcclxuICAgICAgICAgICAgdGhpcy5fb25TZXQuZm9yRWFjaChjYWxsYmFjayA9PiBjYWxsYmFjayh0aGlzLl92YWx1ZSwgdGhpcy5fdmFsdWUpKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlsIbmlbDnu4TkuK3mjIflrprpg6jliIbnmoTlgLzloavlhYXkuLrmjIflrprlgLzjgILms6jmhI/vvIzloavlhYXlrozmiJDkuYvlkI7lsIbop6blj5FvblNldOS6i+S7tlxyXG4gICAgICogQHBhcmFtIHZhbHVlIOimgeWhq+WFheeahOWAvFxyXG4gICAgICogQHBhcmFtIHN0YXJ0IOW8gOWni+S9jee9rlxyXG4gICAgICogQHBhcmFtIGVuZCDnu5PmnZ/kvY3nva5cclxuICAgICAqL1xyXG4gICAgZmlsbCh2YWx1ZTogVCwgc3RhcnQ/OiBudW1iZXIsIGVuZD86IG51bWJlcik6IHRoaXMge1xyXG4gICAgICAgIHRoaXMuX3ZhbHVlLmZpbGwodmFsdWUsIHN0YXJ0LCBlbmQpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fb25TZXQuc2l6ZSA+IDApXHJcbiAgICAgICAgICAgIHRoaXMuX29uU2V0LmZvckVhY2goY2FsbGJhY2sgPT4gY2FsbGJhY2sodGhpcy5fdmFsdWUsIHRoaXMuX3ZhbHVlKSk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5rWF5aSN5Yi25pWw57uE55qE5LiA6YOo5YiG5Yiw5ZCM5LiA5pWw57uE5Lit55qE5Y+m5LiA5Liq5L2N572u77yM5bm26L+U5Zue5a6D77yM6ICM5LiN5L+u5pS55YW25aSn5bCP44CC5rOo5oSP77yM5a6M5oiQ5LmL5ZCO5bCG6Kem5Y+Rb25TZXTkuovku7ZcclxuICAgICAqL1xyXG4gICAgY29weVdpdGhpbih0YXJnZXQ6IG51bWJlciwgc3RhcnQ6IG51bWJlciwgZW5kPzogbnVtYmVyKTogdGhpcyB7XHJcbiAgICAgICAgdGhpcy5fdmFsdWUuY29weVdpdGhpbih0YXJnZXQsIHN0YXJ0LCBlbmQpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fb25TZXQuc2l6ZSA+IDApXHJcbiAgICAgICAgICAgIHRoaXMuX29uU2V0LmZvckVhY2goY2FsbGJhY2sgPT4gY2FsbGJhY2sodGhpcy5fdmFsdWUsIHRoaXMuX3ZhbHVlKSk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIC8vI2VuZHJlZ2lvblxyXG5cclxuICAgIC8vI3JlZ2lvbiDmlbDnu4Tor7vlj5bmk43kvZzmlrnms5VcclxuXHJcbiAgICAvKipcclxuICAgICAqIOeUqOS6juWQiOW5tuS4pOS4quaIluWkmuS4quaVsOe7hOOAguatpOaWueazleS4jeS8muabtOaUueeOsOacieaVsOe7hO+8jOiAjOaYr+i/lOWbnuS4gOS4quaWsOaVsOe7hOOAglxyXG4gICAgICovXHJcbiAgICBjb25jYXQoLi4uaXRlbXM6IENvbmNhdEFycmF5PFQ+W10pIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUuY29uY2F0KC4uLml0ZW1zKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOi/lOWbnuS4gOS4quaWsOeahEFycmF5IEl0ZXJhdG9y5a+56LGh77yM6K+l5a+56LGh5YyF5ZCr5pWw57uE5Lit5q+P5Liq57Si5byV55qE6ZSuL+WAvOWvueOAglxyXG4gICAgICovXHJcbiAgICBlbnRyaWVzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl92YWx1ZS5lbnRyaWVzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmtYvor5XmlbDnu4TnmoTmiYDmnInlhYPntKDmmK/lkKbpg73pgJrov4fkuobmjIflrprlh73mlbDnmoTmtYvor5XjgIJcclxuICAgICAqL1xyXG4gICAgZXZlcnkoY2FsbGJhY2tmbjogKHZhbHVlOiBULCBpbmRleDogbnVtYmVyLCBhcnJheTogVFtdKSA9PiBib29sZWFuLCB0aGlzQXJnPzogYW55KTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlLmV2ZXJ5KGNhbGxiYWNrZm4sIHRoaXNBcmcpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Yib5bu65LiA5Liq5paw5pWw57uELCDlhbbljIXlkKvpgJrov4fmiYDmj5Dkvpvlh73mlbDlrp7njrDnmoTmtYvor5XnmoTmiYDmnInlhYPntKDjgIIgXHJcbiAgICAgKi9cclxuICAgIGZpbHRlcjxTIGV4dGVuZHMgVD4oY2FsbGJhY2tmbjogKHZhbHVlOiBULCBpbmRleDogbnVtYmVyLCBhcnJheTogVFtdKSA9PiB2YWx1ZSBpcyBTLCB0aGlzQXJnPzogYW55KTogU1tdXHJcbiAgICBmaWx0ZXIoY2FsbGJhY2tmbjogKHZhbHVlOiBULCBpbmRleDogbnVtYmVyLCBhcnJheTogVFtdKSA9PiBhbnksIHRoaXNBcmc/OiBhbnkpOiBUW11cclxuICAgIGZpbHRlcihjYWxsYmFja2ZuOiAodmFsdWU6IFQsIGluZGV4OiBudW1iZXIsIGFycmF5OiBUW10pID0+IGFueSwgdGhpc0FyZz86IGFueSk6IFRbXSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlLmZpbHRlcihjYWxsYmFja2ZuLCB0aGlzQXJnKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOi/lOWbnuaVsOe7hOS4rea7oei2s+aPkOS+m+eahOa1i+ivleWHveaVsOeahOesrOS4gOS4quWFg+e0oOeahOWAvOOAguWQpuWImei/lOWbniB1bmRlZmluZWTjgIJcclxuICAgICAqL1xyXG4gICAgZmluZDxTIGV4dGVuZHMgVD4ocHJlZGljYXRlOiAodGhpczogdm9pZCwgdmFsdWU6IFQsIGluZGV4OiBudW1iZXIsIG9iajogVFtdKSA9PiB2YWx1ZSBpcyBTLCB0aGlzQXJnPzogYW55KTogUyB8IHVuZGVmaW5lZFxyXG4gICAgZmluZChwcmVkaWNhdGU6ICh2YWx1ZTogVCwgaW5kZXg6IG51bWJlciwgb2JqOiBUW10pID0+IGJvb2xlYW4sIHRoaXNBcmc/OiBhbnkpOiBUIHwgdW5kZWZpbmVkXHJcbiAgICBmaW5kKHByZWRpY2F0ZTogKHZhbHVlOiBULCBpbmRleDogbnVtYmVyLCBvYmo6IFRbXSkgPT4gYm9vbGVhbiwgdGhpc0FyZz86IGFueSk6IFQgfCB1bmRlZmluZWQge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl92YWx1ZS5maW5kKHByZWRpY2F0ZSwgdGhpc0FyZyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDov5Tlm57mlbDnu4TkuK3mu6HotrPmj5DkvpvnmoTmtYvor5Xlh73mlbDnmoTnrKzkuIDkuKrlhYPntKDnmoTntKLlvJXjgILlkKbliJnov5Tlm54tMeOAglxyXG4gICAgICovXHJcbiAgICBmaW5kSW5kZXgocHJlZGljYXRlOiAodmFsdWU6IFQsIGluZGV4OiBudW1iZXIsIG9iajogVFtdKSA9PiBib29sZWFuLCB0aGlzQXJnPzogYW55KTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUuZmluZEluZGV4KHByZWRpY2F0ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlr7nmlbDnu4TnmoTmr4/kuKrlhYPntKDmiafooYzkuIDmrKHmj5DkvpvnmoTlh73mlbDjgIJcclxuICAgICAqL1xyXG4gICAgZm9yRWFjaChjYWxsYmFja2ZuOiAodmFsdWU6IFQsIGluZGV4OiBudW1iZXIsIGFycmF5OiBUW10pID0+IHZvaWQsIHRoaXNBcmc/OiBhbnkpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLl92YWx1ZS5mb3JFYWNoKGNhbGxiYWNrZm4pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog55So5p2l5Yik5pat5LiA5Liq5pWw57uE5piv5ZCm5YyF5ZCr5LiA5Liq5oyH5a6a55qE5YC877yM5qC55o2u5oOF5Ya177yM5aaC5p6c5YyF5ZCr5YiZ6L+U5ZueIHRydWXvvIzlkKbliJnov5Tlm55mYWxzZeOAglxyXG4gICAgICovXHJcbiAgICBpbmNsdWRlcyhzZWFyY2hFbGVtZW50OiBULCBmcm9tSW5kZXg/OiBudW1iZXIpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUuaW5jbHVkZXMoc2VhcmNoRWxlbWVudCwgZnJvbUluZGV4KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOi/lOWbnuWcqOaVsOe7hOS4reWPr+S7peaJvuWIsOS4gOS4que7meWumuWFg+e0oOeahOesrOS4gOS4que0ouW8le+8jOWmguaenOS4jeWtmOWcqO+8jOWImei/lOWbni0x44CCXHJcbiAgICAgKi9cclxuICAgIGluZGV4T2Yoc2VhcmNoRWxlbWVudDogVCwgZnJvbUluZGV4PzogbnVtYmVyKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUuaW5kZXhPZihzZWFyY2hFbGVtZW50LCBmcm9tSW5kZXgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5pa55rOV5bCG5LiA5Liq5pWw57uE77yI5oiW5LiA5Liq57G75pWw57uE5a+56LGh77yJ55qE5omA5pyJ5YWD57Sg6L+e5o6l5oiQ5LiA5Liq5a2X56ym5Liy5bm26L+U5Zue6L+Z5Liq5a2X56ym5Liy44CCXHJcbiAgICAgKi9cclxuICAgIGpvaW4oc2VwYXJhdG9yPzogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUuam9pbihzZXBhcmF0b3IpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6L+U5Zue5LiA5Liq5paw55qEQXJyYXnov63ku6PlmajvvIzlroPljIXlkKvmlbDnu4TkuK3mr4/kuKrntKLlvJXnmoTplK7jgIJcclxuICAgICAqL1xyXG4gICAga2V5cygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUua2V5cygpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6L+U5Zue5oyH5a6a5YWD57Sg77yI5Lmf5Y2z5pyJ5pWI55qEIEphdmFTY3JpcHQg5YC85oiW5Y+Y6YeP77yJ5Zyo5pWw57uE5Lit55qE5pyA5ZCO5LiA5Liq55qE57Si5byV77yM5aaC5p6c5LiN5a2Y5Zyo5YiZ6L+U5ZueIC0x44CC5LuO5pWw57uE55qE5ZCO6Z2i5ZCR5YmN5p+l5om+77yM5LuOIGZyb21JbmRleCDlpITlvIDlp4vjgIJcclxuICAgICAqL1xyXG4gICAgbGFzdEluZGV4T2Yoc2VhcmNoRWxlbWVudDogVCwgZnJvbUluZGV4PzogbnVtYmVyKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUubGFzdEluZGV4T2Yoc2VhcmNoRWxlbWVudCwgZnJvbUluZGV4KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWIm+W7uuS4gOS4quaWsOaVsOe7hO+8jOWFtue7k+aenOaYr+ivpeaVsOe7hOS4reeahOavj+S4quWFg+e0oOmDveiwg+eUqOS4gOS4quaPkOS+m+eahOWHveaVsOWQjui/lOWbnueahOe7k+aenOOAglxyXG4gICAgICovXHJcbiAgICBtYXA8VT4oY2FsbGJhY2tmbjogKHZhbHVlOiBULCBpbmRleDogbnVtYmVyLCBhcnJheTogVFtdKSA9PiBVLCB0aGlzQXJnPzogYW55KTogVVtdIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUubWFwKGNhbGxiYWNrZm4pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5a+557Sv5Yqg5Zmo5ZKM5pWw57uE5Lit55qE5q+P5Liq5YWD57Sg77yI5LuO5bem5Yiw5Y+z77yJ5bqU55So5LiA5Liq5Ye95pWw77yM5bCG5YW25YeP5bCR5Li65Y2V5Liq5YC844CCXHJcbiAgICAgKi9cclxuICAgIHJlZHVjZShjYWxsYmFja2ZuOiAocHJldmlvdXNWYWx1ZTogVCwgY3VycmVudFZhbHVlOiBULCBjdXJyZW50SW5kZXg6IG51bWJlciwgYXJyYXk6IFRbXSkgPT4gVCk6IFRcclxuICAgIHJlZHVjZShjYWxsYmFja2ZuOiAocHJldmlvdXNWYWx1ZTogVCwgY3VycmVudFZhbHVlOiBULCBjdXJyZW50SW5kZXg6IG51bWJlciwgYXJyYXk6IFRbXSkgPT4gVCwgaW5pdGlhbFZhbHVlOiBUKTogVFxyXG4gICAgcmVkdWNlPFU+KGNhbGxiYWNrZm46IChwcmV2aW91c1ZhbHVlOiBVLCBjdXJyZW50VmFsdWU6IFQsIGN1cnJlbnRJbmRleDogbnVtYmVyLCBhcnJheTogVFtdKSA9PiBVLCBpbml0aWFsVmFsdWU6IFUpOiBVXHJcbiAgICByZWR1Y2UoY2FsbGJhY2tmbjogYW55LCBpbml0aWFsVmFsdWU/OiBhbnkpOiBhbnkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl92YWx1ZS5yZWR1Y2UoY2FsbGJhY2tmbiwgaW5pdGlhbFZhbHVlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOaOpeWPl+S4gOS4quWHveaVsOS9nOS4uue0r+WKoOWZqO+8iGFjY3VtdWxhdG9y77yJ5ZKM5pWw57uE55qE5q+P5Liq5YC877yI5LuO5Y+z5Yiw5bem77yJ5bCG5YW25YeP5bCR5Li65Y2V5Liq5YC844CCXHJcbiAgICAgKi9cclxuICAgIHJlZHVjZVJpZ2h0KGNhbGxiYWNrZm46IChwcmV2aW91c1ZhbHVlOiBULCBjdXJyZW50VmFsdWU6IFQsIGN1cnJlbnRJbmRleDogbnVtYmVyLCBhcnJheTogVFtdKSA9PiBUKTogVFxyXG4gICAgcmVkdWNlUmlnaHQoY2FsbGJhY2tmbjogKHByZXZpb3VzVmFsdWU6IFQsIGN1cnJlbnRWYWx1ZTogVCwgY3VycmVudEluZGV4OiBudW1iZXIsIGFycmF5OiBUW10pID0+IFQsIGluaXRpYWxWYWx1ZTogVCk6IFRcclxuICAgIHJlZHVjZVJpZ2h0PFU+KGNhbGxiYWNrZm46IChwcmV2aW91c1ZhbHVlOiBVLCBjdXJyZW50VmFsdWU6IFQsIGN1cnJlbnRJbmRleDogbnVtYmVyLCBhcnJheTogVFtdKSA9PiBVLCBpbml0aWFsVmFsdWU6IFUpOiBVXHJcbiAgICByZWR1Y2VSaWdodChjYWxsYmFja2ZuOiBhbnksIGluaXRpYWxWYWx1ZT86IGFueSk6IGFueSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlLnJlZHVjZVJpZ2h0KGNhbGxiYWNrZm4sIGluaXRpYWxWYWx1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDov5Tlm57kuIDkuKrku47lvIDlp4vliLDnu5PmnZ/vvIjkuI3ljIXmi6znu5PmnZ/vvInpgInmi6nnmoTmlbDnu4TnmoTkuIDpg6jliIbmtYXmi7fotJ3liLDkuIDkuKrmlrDmlbDnu4Tlr7nosaHjgILkuJTljp/lp4vmlbDnu4TkuI3kvJrooqvkv67mlLnjgIJcclxuICAgICAqL1xyXG4gICAgc2xpY2Uoc3RhcnQ/OiBudW1iZXIsIGVuZD86IG51bWJlcik6IFRbXSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlLnNsaWNlKHN0YXJ0LCBlbmQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5rWL6K+V5pWw57uE5Lit55qE5p+Q5Lqb5YWD57Sg5piv5ZCm6YCa6L+H55Sx5o+Q5L6b55qE5Ye95pWw5a6e546w55qE5rWL6K+V44CCXHJcbiAgICAgKi9cclxuICAgIHNvbWUoY2FsbGJhY2tmbjogKHZhbHVlOiBULCBpbmRleDogbnVtYmVyLCBhcnJheTogVFtdKSA9PiBib29sZWFuLCB0aGlzQXJnPzogYW55KTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlLnNvbWUoY2FsbGJhY2tmbiwgdGhpc0FyZyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDov5Tlm57kuIDkuKrlrZfnrKbkuLLooajnpLrmlbDnu4TkuK3nmoTlhYPntKDjgILmlbDnu4TkuK3nmoTlhYPntKDlsIbkvb/nlKjlkIToh6rnmoQgdG9Mb2NhbGVTdHJpbmcg5pa55rOV6L2s5oiQ5a2X56ym5Liy77yM6L+Z5Lqb5a2X56ym5Liy5bCG5L2/55So5LiA5Liq54m55a6a6K+t6KiA546v5aKD55qE5a2X56ym5Liy77yI5L6L5aaC5LiA5Liq6YCX5Y+3IFwiLFwi77yJ6ZqU5byA44CCXHJcbiAgICAgKi9cclxuICAgIHRvTG9jYWxlU3RyaW5nKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl92YWx1ZS50b0xvY2FsZVN0cmluZygpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6L+U5Zue5LiA5Liq5a2X56ym5Liy77yM6KGo56S65oyH5a6a55qE5pWw57uE5Y+K5YW25YWD57Sg44CCXHJcbiAgICAgKi9cclxuICAgIHRvU3RyaW5nKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl92YWx1ZS50b1N0cmluZygpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6L+U5Zue5LiA5Liq5paw55qEIEFycmF5IEl0ZXJhdG9yIOWvueixoe+8jOivpeWvueixoeWMheWQq+aVsOe7hOavj+S4que0ouW8leeahOWAvFxyXG4gICAgICovXHJcbiAgICB2YWx1ZXMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlLnZhbHVlcygpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vI2VuZHJlZ2lvblxyXG5cclxufVxyXG5leHBvcnQgaW50ZXJmYWNlIE9uQWRkT3JSZW1vdmVBcnJheUVsZW1lbnRDYWxsYmFjazxUPiB7ICh2YWx1ZTogVCk6IHZvaWQgfTsiXX0=
