"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const ObservableVariable_1 = require("./ObservableVariable");
/**
 * 可观察改变数组
 */
class ObservableArray extends ObservableVariable_1.ObservableVariable {
    constructor(value) {
        super(value);
        //#endregion
        //#region 属性
        this._onAdd = new Set();
        this._onRemove = new Set();
    }
    static observe(value, path) {
        if (path === undefined) {
            return new ObservableArray(value);
        }
        else if ('string' === typeof path) {
            path = path.split('.');
        }
        for (let index = 0, end = path.length - 1; index < end; index++) {
            value = value[path[index]];
        }
        value[path[path.length - 1]] = new ObservableArray(value[path[path.length - 1]]);
    }
    /**
     * 数组的长度
     */
    get length() {
        return this._value.length;
    }
    set length(v) {
        this._value.length = v;
    }
    on(event, callback) {
        switch (event) {
            case 'add':
                this._onAdd.add(callback);
                break;
            case 'remove':
                this._onRemove.add(callback);
                break;
            default:
                super.on(event, callback);
                break;
        }
    }
    once(event, callback) {
        super.once(event, callback);
    }
    off(event, callback) {
        switch (event) {
            case 'add':
                callback ? this._onAdd.delete(callback) : this._onAdd.clear();
                break;
            case 'remove':
                callback ? this._onRemove.delete(callback) : this._onRemove.clear();
                break;
            default:
                super.off(event, callback);
                break;
        }
    }
    //#endregion
    //#region 数组修改操作方法
    /**
     * 从数组中删除最后一个元素，并返回该元素的值。此方法更改数组的长度。
     */
    pop() {
        if (this.readonly)
            throw new Error(`尝试修改一个只读的 ${this.constructor.name}`);
        if (this._onRemove.size > 0) {
            const originalLength = this._value.length;
            const result = this._value.pop();
            if (originalLength > this._value.length)
                this._onRemove.forEach(callback => callback(result));
            return result;
        }
        else
            return this._value.pop();
    }
    /**
     * 将一个或多个元素添加到数组的末尾，并返回新数组的长度。
     */
    push(...items) {
        if (this.readonly)
            throw new Error(`尝试修改一个只读的 ${this.constructor.name}`);
        if (this._onAdd.size > 0) {
            items.forEach(item => {
                this._value.push(item);
                this._onAdd.forEach(callback => callback(item));
            });
            return this._value.length;
        }
        else
            return this._value.push(...items);
    }
    /**
     * 从数组中删除第一个元素，并返回该元素的值。此方法更改数组的长度。
     */
    shift() {
        if (this.readonly)
            throw new Error(`尝试修改一个只读的 ${this.constructor.name}`);
        if (this._onRemove.size > 0) {
            const originalLength = this._value.length;
            const result = this._value.shift();
            if (originalLength > this._value.length)
                this._onRemove.forEach(callback => callback(result));
            return result;
        }
        else
            return this._value.shift();
    }
    /**
     * 将一个或多个元素添加到数组的开头，并返回新数组的长度。
     */
    unshift(...items) {
        if (this.readonly)
            throw new Error(`尝试修改一个只读的 ${this.constructor.name}`);
        if (this._onAdd.size > 0) {
            items.forEach((item, index) => {
                this._value.splice(index, 0, item);
                this._onAdd.forEach(callback => callback(item));
            });
            return this._value.length;
        }
        else
            return this._value.unshift(...items);
    }
    splice(start, deleteCount, ...items) {
        if (this.readonly)
            throw new Error(`尝试修改一个只读的 ${this.constructor.name}`);
        if (this._onAdd.size > 0 || this._onRemove.size > 0) {
            let deleteElements = []; //被删除的元素
            start = Math.trunc(start);
            start = start < 0 ? Math.max(this._value.length + start, 0) : Math.min(start, this._value.length);
            if (this._onRemove.size > 0) {
                deleteCount = deleteCount === undefined ? this._value.length - start : deleteCount < 0 ? 0 : Math.min(Math.trunc(deleteCount), this._value.length - start);
                for (let index = 0; index < deleteCount; index++) {
                    const element = this._value.splice(start, 1)[0];
                    this._onRemove.forEach(callback => callback(element));
                    deleteElements.push(element);
                }
            }
            else
                deleteElements = this._value.splice(start, deleteCount);
            if (this._onAdd.size > 0) {
                items.forEach((item, index) => {
                    this._value.splice(start + index, 0, item);
                    this._onAdd.forEach(callback => callback(item));
                });
            }
            else
                this._value.splice(start, 0, ...items);
            return deleteElements;
        }
        else
            return this._value.splice(start, deleteCount, ...items);
    }
    /**
     * 删除数组中第一个与之匹配的元素
     * @param value 要被删除的值
     */
    delete(value) {
        if (this.readonly)
            throw new Error(`尝试修改一个只读的 ${this.constructor.name}`);
        const index = this._value.indexOf(value);
        if (index !== -1) {
            this._value.splice(index, 1);
            if (this._onRemove.size > 0)
                this._onRemove.forEach(callback => callback(value));
            return true;
        }
        else
            return false;
    }
    /**
     * 删除数组中所有与之匹配的元素
     * @param value 要被删除的值
     */
    deleteAll(value) {
        while (this.delete(value))
            ;
    }
    /**
     * 排序数组。注意，排序完成之后将触发onSet事件
     * @param compareFn 排序方法
     */
    sort(compareFn) {
        if (this.readonly)
            throw new Error(`尝试修改一个只读的 ${this.constructor.name}`);
        this._value.sort(compareFn);
        if (this._onSet.size > 0)
            this._onSet.forEach(callback => callback(this._value, this._value));
        return this;
    }
    /**
     * 反转数组中元素顺序。注意，反转完成之后将触发onSet事件
     */
    reverse() {
        if (this.readonly)
            throw new Error(`尝试修改一个只读的 ${this.constructor.name}`);
        this._value.reverse();
        if (this._onSet.size > 0)
            this._onSet.forEach(callback => callback(this._value, this._value));
        return this;
    }
    /**
     * 将数组中指定部分的值填充为指定值。注意，填充完成之后将触发onSet事件
     * @param value 要填充的值
     * @param start 开始位置
     * @param end 结束位置
     */
    fill(value, start, end) {
        if (this.readonly)
            throw new Error(`尝试修改一个只读的 ${this.constructor.name}`);
        this._value.fill(value, start, end);
        if (this._onSet.size > 0)
            this._onSet.forEach(callback => callback(this._value, this._value));
        return this;
    }
    /**
     * 浅复制数组的一部分到同一数组中的另一个位置，并返回它，而不修改其大小。注意，完成之后将触发onSet事件
     */
    copyWithin(target, start, end) {
        if (this.readonly)
            throw new Error(`尝试修改一个只读的 ${this.constructor.name}`);
        this._value.copyWithin(target, start, end);
        if (this._onSet.size > 0)
            this._onSet.forEach(callback => callback(this._value, this._value));
        return this;
    }
    //#endregion
    //#region 数组读取操作方法
    /**
     * 用于合并两个或多个数组。此方法不会更改现有数组，而是返回一个新数组。
     */
    concat(...items) {
        return this._value.concat(...items);
    }
    /**
     * 返回一个新的Array Iterator对象，该对象包含数组中每个索引的键/值对。
     */
    entries() {
        return this._value.entries();
    }
    /**
     * 测试数组的所有元素是否都通过了指定函数的测试。
     */
    every(callbackfn, thisArg) {
        return this._value.every(callbackfn, thisArg);
    }
    filter(callbackfn, thisArg) {
        return this._value.filter(callbackfn, thisArg);
    }
    find(predicate, thisArg) {
        return this._value.find(predicate, thisArg);
    }
    /**
     * 返回数组中满足提供的测试函数的第一个元素的索引。否则返回-1。
     */
    findIndex(predicate, thisArg) {
        return this._value.findIndex(predicate);
    }
    /**
     * 对数组的每个元素执行一次提供的函数。
     */
    forEach(callbackfn, thisArg) {
        this._value.forEach(callbackfn);
    }
    /**
     * 用来判断一个数组是否包含一个指定的值，根据情况，如果包含则返回 true，否则返回false。
     */
    includes(searchElement, fromIndex) {
        return this._value.includes(searchElement, fromIndex);
    }
    /**
     * 返回在数组中可以找到一个给定元素的第一个索引，如果不存在，则返回-1。
     */
    indexOf(searchElement, fromIndex) {
        return this._value.indexOf(searchElement, fromIndex);
    }
    /**
     * 方法将一个数组（或一个类数组对象）的所有元素连接成一个字符串并返回这个字符串。
     */
    join(separator) {
        return this._value.join(separator);
    }
    /**
     * 返回一个新的Array迭代器，它包含数组中每个索引的键。
     */
    keys() {
        return this._value.keys();
    }
    /**
     * 返回指定元素（也即有效的 JavaScript 值或变量）在数组中的最后一个的索引，如果不存在则返回 -1。从数组的后面向前查找，从 fromIndex 处开始。
     */
    lastIndexOf(searchElement, fromIndex) {
        return this._value.lastIndexOf(searchElement, fromIndex);
    }
    /**
     * 创建一个新数组，其结果是该数组中的每个元素都调用一个提供的函数后返回的结果。
     */
    map(callbackfn, thisArg) {
        return this._value.map(callbackfn);
    }
    reduce(callbackfn, initialValue) {
        return this._value.reduce(callbackfn, initialValue);
    }
    reduceRight(callbackfn, initialValue) {
        return this._value.reduceRight(callbackfn, initialValue);
    }
    /**
     * 返回一个从开始到结束（不包括结束）选择的数组的一部分浅拷贝到一个新数组对象。且原始数组不会被修改。
     */
    slice(start, end) {
        return this._value.slice(start, end);
    }
    /**
     * 测试数组中的某些元素是否通过由提供的函数实现的测试。
     */
    some(callbackfn, thisArg) {
        return this._value.some(callbackfn, thisArg);
    }
    /**
     * 返回一个字符串表示数组中的元素。数组中的元素将使用各自的 toLocaleString 方法转成字符串，这些字符串将使用一个特定语言环境的字符串（例如一个逗号 ","）隔开。
     */
    toLocaleString() {
        return this._value.toLocaleString();
    }
    /**
     * 返回一个字符串，表示指定的数组及其元素。
     */
    toString() {
        return this._value.toString();
    }
    /**
     * 返回一个新的 Array Iterator 对象，该对象包含数组每个索引的值
     */
    values() {
        return this._value.values();
    }
}
exports.ObservableArray = ObservableArray;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk9ic2VydmFibGVEYXRhVHlwZS9PYnNlcnZhYmxlQXJyYXkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw2REFBMEQ7QUFFMUQ7O0dBRUc7QUFDSCxxQkFBZ0MsU0FBUSx1Q0FBdUI7SUFxQzNELFlBQVksS0FBK0I7UUFDdkMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBUmpCLFlBQVk7UUFFWixZQUFZO1FBRUYsV0FBTSxHQUE0QixJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQzVDLGNBQVMsR0FBNEIsSUFBSSxHQUFHLEVBQUUsQ0FBQztJQUl6RCxDQUFDO0lBdkJELE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBVSxFQUFFLElBQVU7UUFDakMsSUFBSSxJQUFJLEtBQUssU0FBUyxFQUFFO1lBQ3BCLE9BQU8sSUFBSSxlQUFlLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDckM7YUFBTSxJQUFJLFFBQVEsS0FBSyxPQUFPLElBQUksRUFBRTtZQUNqQyxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUMxQjtRQUVELEtBQUssSUFBSSxLQUFLLEdBQUcsQ0FBQyxFQUFFLEdBQUcsR0FBRyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxLQUFLLEdBQUcsR0FBRyxFQUFFLEtBQUssRUFBRSxFQUFFO1lBQzdELEtBQUssR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7U0FDOUI7UUFFRCxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLGVBQWUsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3JGLENBQUM7SUFhRDs7T0FFRztJQUNILElBQUksTUFBTTtRQUNOLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUM7SUFDOUIsQ0FBQztJQUVELElBQUksTUFBTSxDQUFDLENBQVM7UUFDaEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO0lBQzNCLENBQUM7SUFzQkQsRUFBRSxDQUFDLEtBQVUsRUFBRSxRQUFhO1FBQ3hCLFFBQVEsS0FBSyxFQUFFO1lBQ1gsS0FBSyxLQUFLO2dCQUNOLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUMxQixNQUFNO1lBRVYsS0FBSyxRQUFRO2dCQUNULElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUM3QixNQUFNO1lBRVY7Z0JBQ0ksS0FBSyxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLENBQUM7Z0JBQzFCLE1BQU07U0FDYjtJQUNMLENBQUM7SUFNRCxJQUFJLENBQUMsS0FBVSxFQUFFLFFBQWE7UUFDMUIsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDaEMsQ0FBQztJQU1ELEdBQUcsQ0FBQyxLQUFVLEVBQUUsUUFBYTtRQUN6QixRQUFRLEtBQUssRUFBRTtZQUNYLEtBQUssS0FBSztnQkFDTixRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO2dCQUM5RCxNQUFNO1lBRVYsS0FBSyxRQUFRO2dCQUNULFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBQ3BFLE1BQU07WUFFVjtnQkFDSSxLQUFLLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQztnQkFDM0IsTUFBTTtTQUNiO0lBQ0wsQ0FBQztJQUVELFlBQVk7SUFFWixrQkFBa0I7SUFFbEI7O09BRUc7SUFDSCxHQUFHO1FBQ0MsSUFBSSxJQUFJLENBQUMsUUFBUTtZQUNiLE1BQU0sSUFBSSxLQUFLLENBQUMsYUFBYSxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7UUFFMUQsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksR0FBRyxDQUFDLEVBQUU7WUFDekIsTUFBTSxjQUFjLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUM7WUFDMUMsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUVqQyxJQUFJLGNBQWMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU07Z0JBQ25DLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLE1BQVcsQ0FBQyxDQUFDLENBQUM7WUFFOUQsT0FBTyxNQUFNLENBQUM7U0FDakI7O1lBQ0csT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDO0lBQ2pDLENBQUM7SUFFRDs7T0FFRztJQUNILElBQUksQ0FBQyxHQUFHLEtBQVU7UUFDZCxJQUFJLElBQUksQ0FBQyxRQUFRO1lBQ2IsTUFBTSxJQUFJLEtBQUssQ0FBQyxhQUFhLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUUxRCxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxHQUFHLENBQUMsRUFBRTtZQUN0QixLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO2dCQUNqQixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDdkIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNwRCxDQUFDLENBQUMsQ0FBQztZQUVILE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUM7U0FDN0I7O1lBQ0csT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQyxDQUFDO0lBQzFDLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUs7UUFDRCxJQUFJLElBQUksQ0FBQyxRQUFRO1lBQ2IsTUFBTSxJQUFJLEtBQUssQ0FBQyxhQUFhLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUUxRCxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxHQUFHLENBQUMsRUFBRTtZQUN6QixNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQztZQUMxQyxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBRW5DLElBQUksY0FBYyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTTtnQkFDbkMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsTUFBVyxDQUFDLENBQUMsQ0FBQztZQUU5RCxPQUFPLE1BQU0sQ0FBQztTQUNqQjs7WUFDRyxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDbkMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsT0FBTyxDQUFDLEdBQUcsS0FBVTtRQUNqQixJQUFJLElBQUksQ0FBQyxRQUFRO1lBQ2IsTUFBTSxJQUFJLEtBQUssQ0FBQyxhQUFhLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUUxRCxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxHQUFHLENBQUMsRUFBRTtZQUN0QixLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxFQUFFO2dCQUMxQixJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO2dCQUNuQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ3BELENBQUMsQ0FBQyxDQUFDO1lBRUgsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQztTQUM3Qjs7WUFDRyxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUM7SUFDN0MsQ0FBQztJQWNELE1BQU0sQ0FBQyxLQUFhLEVBQUUsV0FBb0IsRUFBRSxHQUFHLEtBQVU7UUFDckQsSUFBSSxJQUFJLENBQUMsUUFBUTtZQUNiLE1BQU0sSUFBSSxLQUFLLENBQUMsYUFBYSxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7UUFFMUQsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxFQUFFO1lBQ2pELElBQUksY0FBYyxHQUFRLEVBQUUsQ0FBQyxDQUFFLFFBQVE7WUFFdkMsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDMUIsS0FBSyxHQUFHLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBRWxHLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxFQUFFO2dCQUN6QixXQUFXLEdBQUcsV0FBVyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxXQUFXLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUMsQ0FBQztnQkFFM0osS0FBSyxJQUFJLEtBQUssR0FBRyxDQUFDLEVBQUUsS0FBSyxHQUFHLFdBQVcsRUFBRSxLQUFLLEVBQUUsRUFBRTtvQkFDOUMsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUNoRCxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO29CQUN0RCxjQUFjLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2lCQUNoQzthQUNKOztnQkFDRyxjQUFjLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLFdBQVcsQ0FBQyxDQUFDO1lBRTVELElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEdBQUcsQ0FBQyxFQUFFO2dCQUN0QixLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxFQUFFO29CQUMxQixJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsS0FBSyxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztvQkFDM0MsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztnQkFDcEQsQ0FBQyxDQUFDLENBQUM7YUFDTjs7Z0JBQ0csSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxHQUFHLEtBQUssQ0FBQyxDQUFDO1lBRTNDLE9BQU8sY0FBYyxDQUFDO1NBQ3pCOztZQUNHLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLFdBQXFCLEVBQUUsR0FBRyxLQUFLLENBQUMsQ0FBQztJQUMxRSxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsTUFBTSxDQUFDLEtBQVE7UUFDWCxJQUFJLElBQUksQ0FBQyxRQUFRO1lBQ2IsTUFBTSxJQUFJLEtBQUssQ0FBQyxhQUFhLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUUxRCxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUV6QyxJQUFJLEtBQUssS0FBSyxDQUFDLENBQUMsRUFBRTtZQUNkLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztZQUU3QixJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxHQUFHLENBQUM7Z0JBQ3ZCLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFFeEQsT0FBTyxJQUFJLENBQUM7U0FDZjs7WUFDRyxPQUFPLEtBQUssQ0FBQztJQUNyQixDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsU0FBUyxDQUFDLEtBQVE7UUFDZCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO1lBQUMsQ0FBQztJQUMvQixDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsSUFBSSxDQUFDLFNBQWtDO1FBQ25DLElBQUksSUFBSSxDQUFDLFFBQVE7WUFDYixNQUFNLElBQUksS0FBSyxDQUFDLGFBQWEsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBRTFELElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBRTVCLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEdBQUcsQ0FBQztZQUNwQixJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBRXhFLE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFFRDs7T0FFRztJQUNILE9BQU87UUFDSCxJQUFJLElBQUksQ0FBQyxRQUFRO1lBQ2IsTUFBTSxJQUFJLEtBQUssQ0FBQyxhQUFhLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUUxRCxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBRXRCLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEdBQUcsQ0FBQztZQUNwQixJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBRXhFLE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILElBQUksQ0FBQyxLQUFRLEVBQUUsS0FBYyxFQUFFLEdBQVk7UUFDdkMsSUFBSSxJQUFJLENBQUMsUUFBUTtZQUNiLE1BQU0sSUFBSSxLQUFLLENBQUMsYUFBYSxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7UUFFMUQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztRQUVwQyxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxHQUFHLENBQUM7WUFDcEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUV4RSxPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDO0lBRUQ7O09BRUc7SUFDSCxVQUFVLENBQUMsTUFBYyxFQUFFLEtBQWEsRUFBRSxHQUFZO1FBQ2xELElBQUksSUFBSSxDQUFDLFFBQVE7WUFDYixNQUFNLElBQUksS0FBSyxDQUFDLGFBQWEsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBRTFELElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFFM0MsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksR0FBRyxDQUFDO1lBQ3BCLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFFeEUsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUVELFlBQVk7SUFFWixrQkFBa0I7SUFFbEI7O09BRUc7SUFDSCxNQUFNLENBQUMsR0FBRyxLQUF1QjtRQUM3QixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUM7SUFDeEMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsT0FBTztRQUNILE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUNqQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsVUFBNEQsRUFBRSxPQUFhO1FBQzdFLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsVUFBVSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ2xELENBQUM7SUFPRCxNQUFNLENBQUMsVUFBd0QsRUFBRSxPQUFhO1FBQzFFLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsVUFBVSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ25ELENBQUM7SUFPRCxJQUFJLENBQUMsU0FBeUQsRUFBRSxPQUFhO1FBQ3pFLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ2hELENBQUM7SUFFRDs7T0FFRztJQUNILFNBQVMsQ0FBQyxTQUF5RCxFQUFFLE9BQWE7UUFDOUUsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUM1QyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxPQUFPLENBQUMsVUFBeUQsRUFBRSxPQUFhO1FBQzVFLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3BDLENBQUM7SUFFRDs7T0FFRztJQUNILFFBQVEsQ0FBQyxhQUFnQixFQUFFLFNBQWtCO1FBQ3pDLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsYUFBYSxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBQzFELENBQUM7SUFFRDs7T0FFRztJQUNILE9BQU8sQ0FBQyxhQUFnQixFQUFFLFNBQWtCO1FBQ3hDLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBQ3pELENBQUM7SUFFRDs7T0FFRztJQUNILElBQUksQ0FBQyxTQUFrQjtRQUNuQixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFFRDs7T0FFRztJQUNILElBQUk7UUFDQSxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDOUIsQ0FBQztJQUVEOztPQUVHO0lBQ0gsV0FBVyxDQUFDLGFBQWdCLEVBQUUsU0FBa0I7UUFDNUMsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxhQUFhLEVBQUUsU0FBUyxDQUFDLENBQUM7SUFDN0QsQ0FBQztJQUVEOztPQUVHO0lBQ0gsR0FBRyxDQUFJLFVBQXNELEVBQUUsT0FBYTtRQUN4RSxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFRRCxNQUFNLENBQUMsVUFBZSxFQUFFLFlBQWtCO1FBQ3RDLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsVUFBVSxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBQ3hELENBQUM7SUFRRCxXQUFXLENBQUMsVUFBZSxFQUFFLFlBQWtCO1FBQzNDLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsVUFBVSxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBQzdELENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxLQUFjLEVBQUUsR0FBWTtRQUM5QixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztJQUN6QyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxJQUFJLENBQUMsVUFBNEQsRUFBRSxPQUFhO1FBQzVFLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ2pELENBQUM7SUFFRDs7T0FFRztJQUNILGNBQWM7UUFDVixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsY0FBYyxFQUFFLENBQUM7SUFDeEMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsUUFBUTtRQUNKLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUNsQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxNQUFNO1FBQ0YsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ2hDLENBQUM7Q0FHSjtBQXhlRCwwQ0F3ZUMiLCJmaWxlIjoiT2JzZXJ2YWJsZURhdGFUeXBlL09ic2VydmFibGVBcnJheS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGVWYXJpYWJsZSB9IGZyb20gXCIuL09ic2VydmFibGVWYXJpYWJsZVwiO1xyXG5cclxuLyoqXHJcbiAqIOWPr+inguWvn+aUueWPmOaVsOe7hFxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIE9ic2VydmFibGVBcnJheTxUPiBleHRlbmRzIE9ic2VydmFibGVWYXJpYWJsZTxUW10+IHtcclxuXHJcbiAgICAvLyNyZWdpb24g6Z2Z5oCB5pa55rOVXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlsIbkuIDkuKrmlbDnu4TovazmjaLmiJDlj6/op4Llr5/mlbDnu4TvvIznm7jlvZPkuo4gbmV3IE9ic2VydmFibGVBcnJheSh2YWx1ZSlcclxuICAgICAqL1xyXG4gICAgc3RhdGljIG9ic2VydmU8VD4odmFsdWU6IE9ic2VydmFibGVBcnJheTxUPiB8IFRbXSk6IE9ic2VydmFibGVBcnJheTxUPjtcclxuICAgIC8qKlxyXG4gICAgICog5bCG5a+56LGh5Lit5oyH5a6a5L2N572u55qE5LiA5Liq5pWw57uE6L2s5o2i5oiQ5Y+v6KeC5a+f5pWw57uE77yM6Lev5b6E6YCa6L+HYC5g5YiG5YmyXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBvYnNlcnZlKG9iamVjdDogb2JqZWN0LCBwYXRoOiBzdHJpbmcpOiB2b2lkO1xyXG4gICAgLyoqXHJcbiAgICAgKiDlsIblr7nosaHkuK3mjIflrprkvY3nva7nmoTkuIDkuKrmlbDnu4TovazmjaLmiJDlj6/op4Llr5/mlbDnu4RcclxuICAgICAqL1xyXG4gICAgc3RhdGljIG9ic2VydmUob2JqZWN0OiBvYmplY3QsIHBhdGg6IHN0cmluZ1tdKTogdm9pZDtcclxuICAgIHN0YXRpYyBvYnNlcnZlKHZhbHVlOiBhbnksIHBhdGg/OiBhbnkpOiBhbnkge1xyXG4gICAgICAgIGlmIChwYXRoID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlQXJyYXkodmFsdWUpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoJ3N0cmluZycgPT09IHR5cGVvZiBwYXRoKSB7XHJcbiAgICAgICAgICAgIHBhdGggPSBwYXRoLnNwbGl0KCcuJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IgKGxldCBpbmRleCA9IDAsIGVuZCA9IHBhdGgubGVuZ3RoIC0gMTsgaW5kZXggPCBlbmQ7IGluZGV4KyspIHtcclxuICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZVtwYXRoW2luZGV4XV07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YWx1ZVtwYXRoW3BhdGgubGVuZ3RoIC0gMV1dID0gbmV3IE9ic2VydmFibGVBcnJheSh2YWx1ZVtwYXRoW3BhdGgubGVuZ3RoIC0gMV1dKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyNlbmRyZWdpb25cclxuXHJcbiAgICAvLyNyZWdpb24g5bGe5oCnXHJcblxyXG4gICAgcHJvdGVjdGVkIF9vbkFkZDogU2V0PCh2YWx1ZTogVCkgPT4gdm9pZD4gPSBuZXcgU2V0KCk7XHJcbiAgICBwcm90ZWN0ZWQgX29uUmVtb3ZlOiBTZXQ8KHZhbHVlOiBUKSA9PiB2b2lkPiA9IG5ldyBTZXQoKTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcih2YWx1ZTogT2JzZXJ2YWJsZUFycmF5PFQ+IHwgVFtdKSB7XHJcbiAgICAgICAgc3VwZXIodmFsdWUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5pWw57uE55qE6ZW/5bqmXHJcbiAgICAgKi9cclxuICAgIGdldCBsZW5ndGgoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlLmxlbmd0aDtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgbGVuZ3RoKHY6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMuX3ZhbHVlLmxlbmd0aCA9IHY7XHJcbiAgICB9XHJcblxyXG4gICAgLy8jZW5kcmVnaW9uXHJcblxyXG4gICAgLy8jcmVnaW9uIOS6i+S7tue7keWumuaWueazlVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5b2T6K6+572u5YC855qE5pe25YCZ6Kem5Y+RXHJcbiAgICAgKi9cclxuICAgIG9uKGV2ZW50OiAnc2V0JywgY2FsbGJhY2s6IChuZXdWYWx1ZTogVFtdLCBvbGRWYWx1ZTogVFtdKSA9PiB2b2lkKTogdm9pZDtcclxuICAgIC8qKlxyXG4gICAgICog5Zyo5YC85Y+R55Sf5pS55Y+Y5LmL5YmN6Kem5Y+R77yM6L+U5Zuedm9pZOaIlnRydWXooajnpLrlkIzmhI/mm7TmlLnvvIzov5Tlm55mYWxzZeihqOekuumYu+atouabtOaUueOAguazqOaEj++8muivpeWbnuiwg+WPquWFgeiuuOiuvue9ruS4gOS4qu+8jOmHjeWkjeiuvue9ruWwhuimhuebluS5i+WJjeeahOWbnuiwg1xyXG4gICAgICovXHJcbiAgICBvbihldmVudDogJ2JlZm9yZVNldCcsIGNhbGxiYWNrOiAobmV3VmFsdWU6IFRbXSwgb2xkVmFsdWU6IFRbXSwgb0FycjogdGhpcykgPT4gYm9vbGVhbik6IHZvaWQ7XHJcbiAgICAvKipcclxuICAgICAqIOW9k+WQkeaVsOe7hOS4rea3u+WKoOWFg+e0oOaXtuinpuWPkVxyXG4gICAgICovXHJcbiAgICBvbihldmVudDogJ2FkZCcsIGNhbGxiYWNrOiAodmFsdWU6IFQpID0+IHZvaWQpOiB2b2lkO1xyXG4gICAgLyoqXHJcbiAgICAgKiDlvZPliKDpmaTmlbDnu4TkuK3lhYPntKDml7bop6blj5FcclxuICAgICAqL1xyXG4gICAgb24oZXZlbnQ6ICdyZW1vdmUnLCBjYWxsYmFjazogKHZhbHVlOiBUKSA9PiB2b2lkKTogdm9pZDtcclxuICAgIG9uKGV2ZW50OiBhbnksIGNhbGxiYWNrOiBhbnkpOiBhbnkge1xyXG4gICAgICAgIHN3aXRjaCAoZXZlbnQpIHtcclxuICAgICAgICAgICAgY2FzZSAnYWRkJzpcclxuICAgICAgICAgICAgICAgIHRoaXMuX29uQWRkLmFkZChjYWxsYmFjayk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgJ3JlbW92ZSc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9vblJlbW92ZS5hZGQoY2FsbGJhY2spO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgc3VwZXIub24oZXZlbnQsIGNhbGxiYWNrKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvbmNlKGV2ZW50OiAnc2V0JywgY2FsbGJhY2s6IChuZXdWYWx1ZTogVFtdLCBvbGRWYWx1ZTogVFtdKSA9PiB2b2lkKTogdm9pZDtcclxuICAgIG9uY2UoZXZlbnQ6ICdiZWZvcmVTZXQnLCBjYWxsYmFjazogKG5ld1ZhbHVlOiBUW10sIG9sZFZhbHVlOiBUW10sIG9BcnI6IHRoaXMpID0+IGJvb2xlYW4pOiB2b2lkO1xyXG4gICAgb25jZShldmVudDogJ2FkZCcsIGNhbGxiYWNrOiAodmFsdWU6IFQpID0+IHZvaWQpOiB2b2lkO1xyXG4gICAgb25jZShldmVudDogJ3JlbW92ZScsIGNhbGxiYWNrOiAodmFsdWU6IFQpID0+IHZvaWQpOiB2b2lkO1xyXG4gICAgb25jZShldmVudDogYW55LCBjYWxsYmFjazogYW55KTogYW55IHtcclxuICAgICAgICBzdXBlci5vbmNlKGV2ZW50LCBjYWxsYmFjayk7XHJcbiAgICB9XHJcblxyXG4gICAgb2ZmKGV2ZW50OiAnc2V0JywgY2FsbGJhY2s/OiAobmV3VmFsdWU6IFRbXSwgb2xkVmFsdWU6IFRbXSkgPT4gdm9pZCk6IHZvaWQ7XHJcbiAgICBvZmYoZXZlbnQ6ICdiZWZvcmVTZXQnLCBjYWxsYmFjaz86IChuZXdWYWx1ZTogVFtdLCBvbGRWYWx1ZTogVFtdLCBvQXJyOiB0aGlzKSA9PiBib29sZWFuKTogdm9pZDtcclxuICAgIG9mZihldmVudDogJ2FkZCcsIGNhbGxiYWNrPzogKHZhbHVlOiBUKSA9PiB2b2lkKTogdm9pZDtcclxuICAgIG9mZihldmVudDogJ3JlbW92ZScsIGNhbGxiYWNrPzogKHZhbHVlOiBUKSA9PiB2b2lkKTogdm9pZDtcclxuICAgIG9mZihldmVudDogYW55LCBjYWxsYmFjazogYW55KTogYW55IHtcclxuICAgICAgICBzd2l0Y2ggKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ2FkZCc6XHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjayA/IHRoaXMuX29uQWRkLmRlbGV0ZShjYWxsYmFjaykgOiB0aGlzLl9vbkFkZC5jbGVhcigpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlICdyZW1vdmUnOlxyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2sgPyB0aGlzLl9vblJlbW92ZS5kZWxldGUoY2FsbGJhY2spIDogdGhpcy5fb25SZW1vdmUuY2xlYXIoKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHN1cGVyLm9mZihldmVudCwgY2FsbGJhY2spO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vI2VuZHJlZ2lvblxyXG5cclxuICAgIC8vI3JlZ2lvbiDmlbDnu4Tkv67mlLnmk43kvZzmlrnms5VcclxuXHJcbiAgICAvKipcclxuICAgICAqIOS7juaVsOe7hOS4reWIoOmZpOacgOWQjuS4gOS4quWFg+e0oO+8jOW5tui/lOWbnuivpeWFg+e0oOeahOWAvOOAguatpOaWueazleabtOaUueaVsOe7hOeahOmVv+W6puOAglxyXG4gICAgICovXHJcbiAgICBwb3AoKTogVCB8IHVuZGVmaW5lZCB7XHJcbiAgICAgICAgaWYgKHRoaXMucmVhZG9ubHkpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihg5bCd6K+V5L+u5pS55LiA5Liq5Y+q6K+755qEICR7dGhpcy5jb25zdHJ1Y3Rvci5uYW1lfWApO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fb25SZW1vdmUuc2l6ZSA+IDApIHtcclxuICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxMZW5ndGggPSB0aGlzLl92YWx1ZS5sZW5ndGg7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuX3ZhbHVlLnBvcCgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKG9yaWdpbmFsTGVuZ3RoID4gdGhpcy5fdmFsdWUubGVuZ3RoKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5fb25SZW1vdmUuZm9yRWFjaChjYWxsYmFjayA9PiBjYWxsYmFjayhyZXN1bHQgYXMgVCkpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlLnBvcCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5bCG5LiA5Liq5oiW5aSa5Liq5YWD57Sg5re75Yqg5Yiw5pWw57uE55qE5pyr5bC+77yM5bm26L+U5Zue5paw5pWw57uE55qE6ZW/5bqm44CCXHJcbiAgICAgKi9cclxuICAgIHB1c2goLi4uaXRlbXM6IFRbXSk6IG51bWJlciB7XHJcbiAgICAgICAgaWYgKHRoaXMucmVhZG9ubHkpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihg5bCd6K+V5L+u5pS55LiA5Liq5Y+q6K+755qEICR7dGhpcy5jb25zdHJ1Y3Rvci5uYW1lfWApO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fb25BZGQuc2l6ZSA+IDApIHtcclxuICAgICAgICAgICAgaXRlbXMuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3ZhbHVlLnB1c2goaXRlbSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9vbkFkZC5mb3JFYWNoKGNhbGxiYWNrID0+IGNhbGxiYWNrKGl0ZW0pKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUubGVuZ3RoO1xyXG4gICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUucHVzaCguLi5pdGVtcyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDku47mlbDnu4TkuK3liKDpmaTnrKzkuIDkuKrlhYPntKDvvIzlubbov5Tlm57or6XlhYPntKDnmoTlgLzjgILmraTmlrnms5Xmm7TmlLnmlbDnu4TnmoTplb/luqbjgIJcclxuICAgICAqL1xyXG4gICAgc2hpZnQoKTogVCB8IHVuZGVmaW5lZCB7XHJcbiAgICAgICAgaWYgKHRoaXMucmVhZG9ubHkpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihg5bCd6K+V5L+u5pS55LiA5Liq5Y+q6K+755qEICR7dGhpcy5jb25zdHJ1Y3Rvci5uYW1lfWApO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fb25SZW1vdmUuc2l6ZSA+IDApIHtcclxuICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxMZW5ndGggPSB0aGlzLl92YWx1ZS5sZW5ndGg7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuX3ZhbHVlLnNoaWZ0KCk7XHJcblxyXG4gICAgICAgICAgICBpZiAob3JpZ2luYWxMZW5ndGggPiB0aGlzLl92YWx1ZS5sZW5ndGgpXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9vblJlbW92ZS5mb3JFYWNoKGNhbGxiYWNrID0+IGNhbGxiYWNrKHJlc3VsdCBhcyBUKSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUuc2hpZnQoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWwhuS4gOS4quaIluWkmuS4quWFg+e0oOa3u+WKoOWIsOaVsOe7hOeahOW8gOWktO+8jOW5tui/lOWbnuaWsOaVsOe7hOeahOmVv+W6puOAglxyXG4gICAgICovXHJcbiAgICB1bnNoaWZ0KC4uLml0ZW1zOiBUW10pOiBudW1iZXIge1xyXG4gICAgICAgIGlmICh0aGlzLnJlYWRvbmx5KVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYOWwneivleS/ruaUueS4gOS4quWPquivu+eahCAke3RoaXMuY29uc3RydWN0b3IubmFtZX1gKTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX29uQWRkLnNpemUgPiAwKSB7XHJcbiAgICAgICAgICAgIGl0ZW1zLmZvckVhY2goKGl0ZW0sIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl92YWx1ZS5zcGxpY2UoaW5kZXgsIDAsIGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fb25BZGQuZm9yRWFjaChjYWxsYmFjayA9PiBjYWxsYmFjayhpdGVtKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlLmxlbmd0aDtcclxuICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlLnVuc2hpZnQoLi4uaXRlbXMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5LuO5oyH5a6a5L2N572u5byA5aeL5Yig6Zmk5pWw57uE5Ymp5LiL55qE5YWD57SgXHJcbiAgICAgKiBAcGFyYW0gc3RhcnQg5LuO5ZOq5byA5aeL5Yig6Zmk5YWD57SgXHJcbiAgICAgKi9cclxuICAgIHNwbGljZShzdGFydDogbnVtYmVyLCBkZWxldGVDb3VudD86IG51bWJlcik6IFRbXTtcclxuICAgIC8qKlxyXG4gICAgICog5pS55Y+Y5pWw57uE55qE5YaF5a6577yM6YCa6L+H56e76Zmk5oiW5re75Yqg5paw5YWD57SgXHJcbiAgICAgKiBAcGFyYW0gc3RhcnQg5LuO5ZOq5byA5aeL5Yig6Zmk5YWD57SgXHJcbiAgICAgKiBAcGFyYW0gZGVsZXRlQ291bnQg5Yig6Zmk5aSa5bCR5Liq5YWD57SgXHJcbiAgICAgKiBAcGFyYW0gaXRlbXMg6KaB5o+S5YWl55qE5YWD57SgXHJcbiAgICAgKi9cclxuICAgIHNwbGljZShzdGFydDogbnVtYmVyLCBkZWxldGVDb3VudDogbnVtYmVyLCAuLi5pdGVtczogVFtdKTogVFtdO1xyXG4gICAgc3BsaWNlKHN0YXJ0OiBudW1iZXIsIGRlbGV0ZUNvdW50PzogbnVtYmVyLCAuLi5pdGVtczogVFtdKTogVFtdIHtcclxuICAgICAgICBpZiAodGhpcy5yZWFkb25seSlcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGDlsJ3or5Xkv67mlLnkuIDkuKrlj6ror7vnmoQgJHt0aGlzLmNvbnN0cnVjdG9yLm5hbWV9YCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9vbkFkZC5zaXplID4gMCB8fCB0aGlzLl9vblJlbW92ZS5zaXplID4gMCkge1xyXG4gICAgICAgICAgICBsZXQgZGVsZXRlRWxlbWVudHM6IFRbXSA9IFtdOyAgLy/ooqvliKDpmaTnmoTlhYPntKBcclxuXHJcbiAgICAgICAgICAgIHN0YXJ0ID0gTWF0aC50cnVuYyhzdGFydCk7XHJcbiAgICAgICAgICAgIHN0YXJ0ID0gc3RhcnQgPCAwID8gTWF0aC5tYXgodGhpcy5fdmFsdWUubGVuZ3RoICsgc3RhcnQsIDApIDogTWF0aC5taW4oc3RhcnQsIHRoaXMuX3ZhbHVlLmxlbmd0aCk7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5fb25SZW1vdmUuc2l6ZSA+IDApIHtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZUNvdW50ID0gZGVsZXRlQ291bnQgPT09IHVuZGVmaW5lZCA/IHRoaXMuX3ZhbHVlLmxlbmd0aCAtIHN0YXJ0IDogZGVsZXRlQ291bnQgPCAwID8gMCA6IE1hdGgubWluKE1hdGgudHJ1bmMoZGVsZXRlQ291bnQpLCB0aGlzLl92YWx1ZS5sZW5ndGggLSBzdGFydCk7XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGRlbGV0ZUNvdW50OyBpbmRleCsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMuX3ZhbHVlLnNwbGljZShzdGFydCwgMSlbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb25SZW1vdmUuZm9yRWFjaChjYWxsYmFjayA9PiBjYWxsYmFjayhlbGVtZW50KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlRWxlbWVudHMucHVzaChlbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICAgICAgICBkZWxldGVFbGVtZW50cyA9IHRoaXMuX3ZhbHVlLnNwbGljZShzdGFydCwgZGVsZXRlQ291bnQpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuX29uQWRkLnNpemUgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVtcy5mb3JFYWNoKChpdGVtLCBpbmRleCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3ZhbHVlLnNwbGljZShzdGFydCArIGluZGV4LCAwLCBpdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9vbkFkZC5mb3JFYWNoKGNhbGxiYWNrID0+IGNhbGxiYWNrKGl0ZW0pKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgIHRoaXMuX3ZhbHVlLnNwbGljZShzdGFydCwgMCwgLi4uaXRlbXMpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRlbGV0ZUVsZW1lbnRzO1xyXG4gICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUuc3BsaWNlKHN0YXJ0LCBkZWxldGVDb3VudCBhcyBudW1iZXIsIC4uLml0ZW1zKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWIoOmZpOaVsOe7hOS4reesrOS4gOS4quS4juS5i+WMuemFjeeahOWFg+e0oFxyXG4gICAgICogQHBhcmFtIHZhbHVlIOimgeiiq+WIoOmZpOeahOWAvFxyXG4gICAgICovXHJcbiAgICBkZWxldGUodmFsdWU6IFQpOiBib29sZWFuIHtcclxuICAgICAgICBpZiAodGhpcy5yZWFkb25seSlcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGDlsJ3or5Xkv67mlLnkuIDkuKrlj6ror7vnmoQgJHt0aGlzLmNvbnN0cnVjdG9yLm5hbWV9YCk7XHJcblxyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5fdmFsdWUuaW5kZXhPZih2YWx1ZSk7XHJcblxyXG4gICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcclxuICAgICAgICAgICAgdGhpcy5fdmFsdWUuc3BsaWNlKGluZGV4LCAxKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9vblJlbW92ZS5zaXplID4gMClcclxuICAgICAgICAgICAgICAgIHRoaXMuX29uUmVtb3ZlLmZvckVhY2goY2FsbGJhY2sgPT4gY2FsbGJhY2sodmFsdWUpKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0gZWxzZVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliKDpmaTmlbDnu4TkuK3miYDmnInkuI7kuYvljLnphY3nmoTlhYPntKBcclxuICAgICAqIEBwYXJhbSB2YWx1ZSDopoHooqvliKDpmaTnmoTlgLxcclxuICAgICAqL1xyXG4gICAgZGVsZXRlQWxsKHZhbHVlOiBUKTogdm9pZCB7XHJcbiAgICAgICAgd2hpbGUgKHRoaXMuZGVsZXRlKHZhbHVlKSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmjpLluo/mlbDnu4TjgILms6jmhI/vvIzmjpLluo/lrozmiJDkuYvlkI7lsIbop6blj5FvblNldOS6i+S7tlxyXG4gICAgICogQHBhcmFtIGNvbXBhcmVGbiDmjpLluo/mlrnms5VcclxuICAgICAqL1xyXG4gICAgc29ydChjb21wYXJlRm4/OiAoYTogVCwgYjogVCkgPT4gbnVtYmVyKTogdGhpcyB7XHJcbiAgICAgICAgaWYgKHRoaXMucmVhZG9ubHkpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihg5bCd6K+V5L+u5pS55LiA5Liq5Y+q6K+755qEICR7dGhpcy5jb25zdHJ1Y3Rvci5uYW1lfWApO1xyXG5cclxuICAgICAgICB0aGlzLl92YWx1ZS5zb3J0KGNvbXBhcmVGbik7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9vblNldC5zaXplID4gMClcclxuICAgICAgICAgICAgdGhpcy5fb25TZXQuZm9yRWFjaChjYWxsYmFjayA9PiBjYWxsYmFjayh0aGlzLl92YWx1ZSwgdGhpcy5fdmFsdWUpKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlj43ovazmlbDnu4TkuK3lhYPntKDpobrluo/jgILms6jmhI/vvIzlj43ovazlrozmiJDkuYvlkI7lsIbop6blj5FvblNldOS6i+S7tlxyXG4gICAgICovXHJcbiAgICByZXZlcnNlKCk6IHRoaXMge1xyXG4gICAgICAgIGlmICh0aGlzLnJlYWRvbmx5KVxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYOWwneivleS/ruaUueS4gOS4quWPquivu+eahCAke3RoaXMuY29uc3RydWN0b3IubmFtZX1gKTtcclxuXHJcbiAgICAgICAgdGhpcy5fdmFsdWUucmV2ZXJzZSgpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fb25TZXQuc2l6ZSA+IDApXHJcbiAgICAgICAgICAgIHRoaXMuX29uU2V0LmZvckVhY2goY2FsbGJhY2sgPT4gY2FsbGJhY2sodGhpcy5fdmFsdWUsIHRoaXMuX3ZhbHVlKSk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5bCG5pWw57uE5Lit5oyH5a6a6YOo5YiG55qE5YC85aGr5YWF5Li65oyH5a6a5YC844CC5rOo5oSP77yM5aGr5YWF5a6M5oiQ5LmL5ZCO5bCG6Kem5Y+Rb25TZXTkuovku7ZcclxuICAgICAqIEBwYXJhbSB2YWx1ZSDopoHloavlhYXnmoTlgLxcclxuICAgICAqIEBwYXJhbSBzdGFydCDlvIDlp4vkvY3nva5cclxuICAgICAqIEBwYXJhbSBlbmQg57uT5p2f5L2N572uXHJcbiAgICAgKi9cclxuICAgIGZpbGwodmFsdWU6IFQsIHN0YXJ0PzogbnVtYmVyLCBlbmQ/OiBudW1iZXIpOiB0aGlzIHtcclxuICAgICAgICBpZiAodGhpcy5yZWFkb25seSlcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGDlsJ3or5Xkv67mlLnkuIDkuKrlj6ror7vnmoQgJHt0aGlzLmNvbnN0cnVjdG9yLm5hbWV9YCk7XHJcblxyXG4gICAgICAgIHRoaXMuX3ZhbHVlLmZpbGwodmFsdWUsIHN0YXJ0LCBlbmQpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fb25TZXQuc2l6ZSA+IDApXHJcbiAgICAgICAgICAgIHRoaXMuX29uU2V0LmZvckVhY2goY2FsbGJhY2sgPT4gY2FsbGJhY2sodGhpcy5fdmFsdWUsIHRoaXMuX3ZhbHVlKSk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5rWF5aSN5Yi25pWw57uE55qE5LiA6YOo5YiG5Yiw5ZCM5LiA5pWw57uE5Lit55qE5Y+m5LiA5Liq5L2N572u77yM5bm26L+U5Zue5a6D77yM6ICM5LiN5L+u5pS55YW25aSn5bCP44CC5rOo5oSP77yM5a6M5oiQ5LmL5ZCO5bCG6Kem5Y+Rb25TZXTkuovku7ZcclxuICAgICAqL1xyXG4gICAgY29weVdpdGhpbih0YXJnZXQ6IG51bWJlciwgc3RhcnQ6IG51bWJlciwgZW5kPzogbnVtYmVyKTogdGhpcyB7XHJcbiAgICAgICAgaWYgKHRoaXMucmVhZG9ubHkpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihg5bCd6K+V5L+u5pS55LiA5Liq5Y+q6K+755qEICR7dGhpcy5jb25zdHJ1Y3Rvci5uYW1lfWApO1xyXG5cclxuICAgICAgICB0aGlzLl92YWx1ZS5jb3B5V2l0aGluKHRhcmdldCwgc3RhcnQsIGVuZCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9vblNldC5zaXplID4gMClcclxuICAgICAgICAgICAgdGhpcy5fb25TZXQuZm9yRWFjaChjYWxsYmFjayA9PiBjYWxsYmFjayh0aGlzLl92YWx1ZSwgdGhpcy5fdmFsdWUpKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgLy8jZW5kcmVnaW9uXHJcblxyXG4gICAgLy8jcmVnaW9uIOaVsOe7hOivu+WPluaTjeS9nOaWueazlVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog55So5LqO5ZCI5bm25Lik5Liq5oiW5aSa5Liq5pWw57uE44CC5q2k5pa55rOV5LiN5Lya5pu05pS5546w5pyJ5pWw57uE77yM6ICM5piv6L+U5Zue5LiA5Liq5paw5pWw57uE44CCXHJcbiAgICAgKi9cclxuICAgIGNvbmNhdCguLi5pdGVtczogQ29uY2F0QXJyYXk8VD5bXSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl92YWx1ZS5jb25jYXQoLi4uaXRlbXMpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6L+U5Zue5LiA5Liq5paw55qEQXJyYXkgSXRlcmF0b3Llr7nosaHvvIzor6Xlr7nosaHljIXlkKvmlbDnu4TkuK3mr4/kuKrntKLlvJXnmoTplK4v5YC85a+544CCXHJcbiAgICAgKi9cclxuICAgIGVudHJpZXMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlLmVudHJpZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOa1i+ivleaVsOe7hOeahOaJgOacieWFg+e0oOaYr+WQpumDvemAmui/h+S6huaMh+WumuWHveaVsOeahOa1i+ivleOAglxyXG4gICAgICovXHJcbiAgICBldmVyeShjYWxsYmFja2ZuOiAodmFsdWU6IFQsIGluZGV4OiBudW1iZXIsIGFycmF5OiBUW10pID0+IGJvb2xlYW4sIHRoaXNBcmc/OiBhbnkpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUuZXZlcnkoY2FsbGJhY2tmbiwgdGhpc0FyZyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliJvlu7rkuIDkuKrmlrDmlbDnu4QsIOWFtuWMheWQq+mAmui/h+aJgOaPkOS+m+WHveaVsOWunueOsOeahOa1i+ivleeahOaJgOacieWFg+e0oOOAgiBcclxuICAgICAqL1xyXG4gICAgZmlsdGVyPFMgZXh0ZW5kcyBUPihjYWxsYmFja2ZuOiAodmFsdWU6IFQsIGluZGV4OiBudW1iZXIsIGFycmF5OiBUW10pID0+IHZhbHVlIGlzIFMsIHRoaXNBcmc/OiBhbnkpOiBTW11cclxuICAgIGZpbHRlcihjYWxsYmFja2ZuOiAodmFsdWU6IFQsIGluZGV4OiBudW1iZXIsIGFycmF5OiBUW10pID0+IGFueSwgdGhpc0FyZz86IGFueSk6IFRbXVxyXG4gICAgZmlsdGVyKGNhbGxiYWNrZm46ICh2YWx1ZTogVCwgaW5kZXg6IG51bWJlciwgYXJyYXk6IFRbXSkgPT4gYW55LCB0aGlzQXJnPzogYW55KTogVFtdIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUuZmlsdGVyKGNhbGxiYWNrZm4sIHRoaXNBcmcpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6L+U5Zue5pWw57uE5Lit5ruh6Laz5o+Q5L6b55qE5rWL6K+V5Ye95pWw55qE56ys5LiA5Liq5YWD57Sg55qE5YC844CC5ZCm5YiZ6L+U5ZueIHVuZGVmaW5lZOOAglxyXG4gICAgICovXHJcbiAgICBmaW5kPFMgZXh0ZW5kcyBUPihwcmVkaWNhdGU6ICh0aGlzOiB2b2lkLCB2YWx1ZTogVCwgaW5kZXg6IG51bWJlciwgb2JqOiBUW10pID0+IHZhbHVlIGlzIFMsIHRoaXNBcmc/OiBhbnkpOiBTIHwgdW5kZWZpbmVkXHJcbiAgICBmaW5kKHByZWRpY2F0ZTogKHZhbHVlOiBULCBpbmRleDogbnVtYmVyLCBvYmo6IFRbXSkgPT4gYm9vbGVhbiwgdGhpc0FyZz86IGFueSk6IFQgfCB1bmRlZmluZWRcclxuICAgIGZpbmQocHJlZGljYXRlOiAodmFsdWU6IFQsIGluZGV4OiBudW1iZXIsIG9iajogVFtdKSA9PiBib29sZWFuLCB0aGlzQXJnPzogYW55KTogVCB8IHVuZGVmaW5lZCB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlLmZpbmQocHJlZGljYXRlLCB0aGlzQXJnKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOi/lOWbnuaVsOe7hOS4rea7oei2s+aPkOS+m+eahOa1i+ivleWHveaVsOeahOesrOS4gOS4quWFg+e0oOeahOe0ouW8leOAguWQpuWImei/lOWbni0x44CCXHJcbiAgICAgKi9cclxuICAgIGZpbmRJbmRleChwcmVkaWNhdGU6ICh2YWx1ZTogVCwgaW5kZXg6IG51bWJlciwgb2JqOiBUW10pID0+IGJvb2xlYW4sIHRoaXNBcmc/OiBhbnkpOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl92YWx1ZS5maW5kSW5kZXgocHJlZGljYXRlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWvueaVsOe7hOeahOavj+S4quWFg+e0oOaJp+ihjOS4gOasoeaPkOS+m+eahOWHveaVsOOAglxyXG4gICAgICovXHJcbiAgICBmb3JFYWNoKGNhbGxiYWNrZm46ICh2YWx1ZTogVCwgaW5kZXg6IG51bWJlciwgYXJyYXk6IFRbXSkgPT4gdm9pZCwgdGhpc0FyZz86IGFueSk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuX3ZhbHVlLmZvckVhY2goY2FsbGJhY2tmbik7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDnlKjmnaXliKTmlq3kuIDkuKrmlbDnu4TmmK/lkKbljIXlkKvkuIDkuKrmjIflrprnmoTlgLzvvIzmoLnmja7mg4XlhrXvvIzlpoLmnpzljIXlkKvliJnov5Tlm54gdHJ1Ze+8jOWQpuWImei/lOWbnmZhbHNl44CCXHJcbiAgICAgKi9cclxuICAgIGluY2x1ZGVzKHNlYXJjaEVsZW1lbnQ6IFQsIGZyb21JbmRleD86IG51bWJlcik6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl92YWx1ZS5pbmNsdWRlcyhzZWFyY2hFbGVtZW50LCBmcm9tSW5kZXgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6L+U5Zue5Zyo5pWw57uE5Lit5Y+v5Lul5om+5Yiw5LiA5Liq57uZ5a6a5YWD57Sg55qE56ys5LiA5Liq57Si5byV77yM5aaC5p6c5LiN5a2Y5Zyo77yM5YiZ6L+U5ZueLTHjgIJcclxuICAgICAqL1xyXG4gICAgaW5kZXhPZihzZWFyY2hFbGVtZW50OiBULCBmcm9tSW5kZXg/OiBudW1iZXIpOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl92YWx1ZS5pbmRleE9mKHNlYXJjaEVsZW1lbnQsIGZyb21JbmRleCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmlrnms5XlsIbkuIDkuKrmlbDnu4TvvIjmiJbkuIDkuKrnsbvmlbDnu4Tlr7nosaHvvInnmoTmiYDmnInlhYPntKDov57mjqXmiJDkuIDkuKrlrZfnrKbkuLLlubbov5Tlm57ov5nkuKrlrZfnrKbkuLLjgIJcclxuICAgICAqL1xyXG4gICAgam9pbihzZXBhcmF0b3I/OiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl92YWx1ZS5qb2luKHNlcGFyYXRvcik7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDov5Tlm57kuIDkuKrmlrDnmoRBcnJheei/reS7o+WZqO+8jOWug+WMheWQq+aVsOe7hOS4reavj+S4que0ouW8leeahOmUruOAglxyXG4gICAgICovXHJcbiAgICBrZXlzKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl92YWx1ZS5rZXlzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDov5Tlm57mjIflrprlhYPntKDvvIjkuZ/ljbPmnInmlYjnmoQgSmF2YVNjcmlwdCDlgLzmiJblj5jph4/vvInlnKjmlbDnu4TkuK3nmoTmnIDlkI7kuIDkuKrnmoTntKLlvJXvvIzlpoLmnpzkuI3lrZjlnKjliJnov5Tlm54gLTHjgILku47mlbDnu4TnmoTlkI7pnaLlkJHliY3mn6Xmib7vvIzku44gZnJvbUluZGV4IOWkhOW8gOWni+OAglxyXG4gICAgICovXHJcbiAgICBsYXN0SW5kZXhPZihzZWFyY2hFbGVtZW50OiBULCBmcm9tSW5kZXg/OiBudW1iZXIpOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl92YWx1ZS5sYXN0SW5kZXhPZihzZWFyY2hFbGVtZW50LCBmcm9tSW5kZXgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Yib5bu65LiA5Liq5paw5pWw57uE77yM5YW257uT5p6c5piv6K+l5pWw57uE5Lit55qE5q+P5Liq5YWD57Sg6YO96LCD55So5LiA5Liq5o+Q5L6b55qE5Ye95pWw5ZCO6L+U5Zue55qE57uT5p6c44CCXHJcbiAgICAgKi9cclxuICAgIG1hcDxVPihjYWxsYmFja2ZuOiAodmFsdWU6IFQsIGluZGV4OiBudW1iZXIsIGFycmF5OiBUW10pID0+IFUsIHRoaXNBcmc/OiBhbnkpOiBVW10ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl92YWx1ZS5tYXAoY2FsbGJhY2tmbik7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDlr7nntK/liqDlmajlkozmlbDnu4TkuK3nmoTmr4/kuKrlhYPntKDvvIjku47lt6bliLDlj7PvvInlupTnlKjkuIDkuKrlh73mlbDvvIzlsIblhbblh4/lsJHkuLrljZXkuKrlgLzjgIJcclxuICAgICAqL1xyXG4gICAgcmVkdWNlKGNhbGxiYWNrZm46IChwcmV2aW91c1ZhbHVlOiBULCBjdXJyZW50VmFsdWU6IFQsIGN1cnJlbnRJbmRleDogbnVtYmVyLCBhcnJheTogVFtdKSA9PiBUKTogVFxyXG4gICAgcmVkdWNlKGNhbGxiYWNrZm46IChwcmV2aW91c1ZhbHVlOiBULCBjdXJyZW50VmFsdWU6IFQsIGN1cnJlbnRJbmRleDogbnVtYmVyLCBhcnJheTogVFtdKSA9PiBULCBpbml0aWFsVmFsdWU6IFQpOiBUXHJcbiAgICByZWR1Y2U8VT4oY2FsbGJhY2tmbjogKHByZXZpb3VzVmFsdWU6IFUsIGN1cnJlbnRWYWx1ZTogVCwgY3VycmVudEluZGV4OiBudW1iZXIsIGFycmF5OiBUW10pID0+IFUsIGluaXRpYWxWYWx1ZTogVSk6IFVcclxuICAgIHJlZHVjZShjYWxsYmFja2ZuOiBhbnksIGluaXRpYWxWYWx1ZT86IGFueSk6IGFueSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlLnJlZHVjZShjYWxsYmFja2ZuLCBpbml0aWFsVmFsdWUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5o6l5Y+X5LiA5Liq5Ye95pWw5L2c5Li657Sv5Yqg5Zmo77yIYWNjdW11bGF0b3LvvInlkozmlbDnu4TnmoTmr4/kuKrlgLzvvIjku47lj7PliLDlt6bvvInlsIblhbblh4/lsJHkuLrljZXkuKrlgLzjgIJcclxuICAgICAqL1xyXG4gICAgcmVkdWNlUmlnaHQoY2FsbGJhY2tmbjogKHByZXZpb3VzVmFsdWU6IFQsIGN1cnJlbnRWYWx1ZTogVCwgY3VycmVudEluZGV4OiBudW1iZXIsIGFycmF5OiBUW10pID0+IFQpOiBUXHJcbiAgICByZWR1Y2VSaWdodChjYWxsYmFja2ZuOiAocHJldmlvdXNWYWx1ZTogVCwgY3VycmVudFZhbHVlOiBULCBjdXJyZW50SW5kZXg6IG51bWJlciwgYXJyYXk6IFRbXSkgPT4gVCwgaW5pdGlhbFZhbHVlOiBUKTogVFxyXG4gICAgcmVkdWNlUmlnaHQ8VT4oY2FsbGJhY2tmbjogKHByZXZpb3VzVmFsdWU6IFUsIGN1cnJlbnRWYWx1ZTogVCwgY3VycmVudEluZGV4OiBudW1iZXIsIGFycmF5OiBUW10pID0+IFUsIGluaXRpYWxWYWx1ZTogVSk6IFVcclxuICAgIHJlZHVjZVJpZ2h0KGNhbGxiYWNrZm46IGFueSwgaW5pdGlhbFZhbHVlPzogYW55KTogYW55IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUucmVkdWNlUmlnaHQoY2FsbGJhY2tmbiwgaW5pdGlhbFZhbHVlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOi/lOWbnuS4gOS4quS7juW8gOWni+WIsOe7k+adn++8iOS4jeWMheaLrOe7k+adn++8iemAieaLqeeahOaVsOe7hOeahOS4gOmDqOWIhua1heaLt+i0neWIsOS4gOS4quaWsOaVsOe7hOWvueixoeOAguS4lOWOn+Wni+aVsOe7hOS4jeS8muiiq+S/ruaUueOAglxyXG4gICAgICovXHJcbiAgICBzbGljZShzdGFydD86IG51bWJlciwgZW5kPzogbnVtYmVyKTogVFtdIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUuc2xpY2Uoc3RhcnQsIGVuZCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmtYvor5XmlbDnu4TkuK3nmoTmn5DkupvlhYPntKDmmK/lkKbpgJrov4fnlLHmj5DkvpvnmoTlh73mlbDlrp7njrDnmoTmtYvor5XjgIJcclxuICAgICAqL1xyXG4gICAgc29tZShjYWxsYmFja2ZuOiAodmFsdWU6IFQsIGluZGV4OiBudW1iZXIsIGFycmF5OiBUW10pID0+IGJvb2xlYW4sIHRoaXNBcmc/OiBhbnkpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUuc29tZShjYWxsYmFja2ZuLCB0aGlzQXJnKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOi/lOWbnuS4gOS4quWtl+espuS4suihqOekuuaVsOe7hOS4reeahOWFg+e0oOOAguaVsOe7hOS4reeahOWFg+e0oOWwhuS9v+eUqOWQhOiHqueahCB0b0xvY2FsZVN0cmluZyDmlrnms5XovazmiJDlrZfnrKbkuLLvvIzov5nkupvlrZfnrKbkuLLlsIbkvb/nlKjkuIDkuKrnibnlrpror63oqIDnjq/looPnmoTlrZfnrKbkuLLvvIjkvovlpoLkuIDkuKrpgJflj7cgXCIsXCLvvInpmpTlvIDjgIJcclxuICAgICAqL1xyXG4gICAgdG9Mb2NhbGVTdHJpbmcoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlLnRvTG9jYWxlU3RyaW5nKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDov5Tlm57kuIDkuKrlrZfnrKbkuLLvvIzooajnpLrmjIflrprnmoTmlbDnu4Tlj4rlhbblhYPntKDjgIJcclxuICAgICAqL1xyXG4gICAgdG9TdHJpbmcoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlLnRvU3RyaW5nKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDov5Tlm57kuIDkuKrmlrDnmoQgQXJyYXkgSXRlcmF0b3Ig5a+56LGh77yM6K+l5a+56LGh5YyF5ZCr5pWw57uE5q+P5Liq57Si5byV55qE5YC8XHJcbiAgICAgKi9cclxuICAgIHZhbHVlcygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWUudmFsdWVzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8jZW5kcmVnaW9uXHJcbn0iXX0=
